<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Linux Systems Administration</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#history-of-unix-and-linux">History of Unix and Linux</a><ul>
<li><a href="#location-bell-labs-part-of-att-new-jersey-late-1960s-through-early-1970s">Location: Bell Labs, part of AT&amp;T (New Jersey), late 1960s through early 1970s</a></li>
<li><a href="#location-berkeley-ca-university-of-california-berkeley-early-to-mid-1970s">Location: Berkeley, CA (University of California, Berkeley), early to mid 1970s</a></li>
<li><a href="#att">AT&amp;T</a></li>
<li><a href="#location-boston-ma-mit-early-1980s-through-early-1990s">Location: Boston, MA (MIT), early 1980s through early 1990s</a></li>
<li><a href="#the-four-freedoms-per-gnu-project">The four freedoms, per GNU Project</a></li>
<li><a href="#the-unix-wars-and-the-lawsuit">The Unix wars and the lawsuit</a></li>
<li><a href="#the-rise-of-linux-linus-torvalds-university-of-helsinki-finland">The Rise of Linux, Linus Torvalds, University of Helsinki, Finland</a></li>
<li><a href="#distributions">Distributions</a></li>
<li><a href="#what-happened-to-bsd">What happened to BSD?</a></li>
<li><a href="#what-happened-with-gnu">What happened with GNU?</a></li>
<li><a href="#free-and-open-source-licenses">Free and Open Source Licenses</a></li>
</ul></li>
<li><a href="#the-linuxunix-file-system-and-file-types">The Linux/Unix File System and File Types</a><ul>
<li><a href="#the-root-directories">The root directories</a></li>
</ul></li>
<li><a href="#gnu-coreutils">GNU Coreutils</a><ul>
<li><a href="#practice-and-examples">Practice and examples</a></li>
</ul></li>
<li><a href="#quick-ssh-connect">Quick SSH Connect</a><ul>
<li><a href="#linux-and-macos">Linux and macOS</a></li>
<li><a href="#windows-with-putty">Windows with PuTTY</a></li>
<li><a href="#putty-configuration">PuTTY Configuration</a></li>
</ul></li>
<li><a href="#learning-bash">Learning Bash</a><ul>
<li><a href="#navigation">Navigation</a></li>
<li><a href="#file-names">File names</a></li>
<li><a href="#manual-pages">Manual pages</a></li>
<li><a href="#file-manipulation">File manipulation</a></li>
<li><a href="#reading-files">Reading Files</a></li>
<li><a href="#creating-output">Creating Output</a><ul>
<li><a href="#practice">Practice</a></li>
</ul></li>
</ul></li>
<li><a href="#bash-scripting">Bash Scripting</a><ul>
<li><a href="#file-ownership-and-permissions">File Ownership and Permissions</a></li>
<li><a href="#grep-and-regular-expressions">Grep and Regular Expressions</a><ul>
<li><a href="#whole-words-case-sensitive-by-default">Whole words, case sensitive by default</a></li>
<li><a href="#character-classes-and-bracket-expressions">Character Classes and Bracket Expressions</a></li>
<li><a href="#anchoring">Anchoring</a></li>
<li><a href="#repetition">Repetition</a></li>
<li><a href="#alternation">Alternation</a></li>
</ul></li>
<li><a href="#test-command-and-if-statements">Test Command and <code>if</code> Statements</a><ul>
<li><a href="#test">Test</a></li>
<li><a href="#if-statements"><code>if</code> Statements</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
<li><a href="#text-editors">Text editors</a><ul>
<li><a href="#ed"><code>ed</code></a></li>
<li><a href="#vim"><code>vim</code></a></li>
<li><a href="#nano"><code>nano</code></a></li>
</ul></li>
<li><a href="#installing-and-setting-up-our-own-server-installations">Installing and Setting Up Our Own Server Installations</a><ul>
<li><a href="#download-and-install-fedora-and-virtualbox">Download and Install fedora and VirtualBox:</a></li>
<li><a href="#set-up-in-virtualbox">Set up in VirtualBox:</a></li>
<li><a href="#install-fedora-32-server-edition">Install Fedora 32 Server Edition:</a></li>
<li><a href="#virtualbox-settings">VirtualBox settings</a></li>
<li><a href="#virtualbox-login">VirtualBox Login</a></li>
</ul></li>
<li><a href="#logical-volume-management">Logical Volume Management</a><ul>
<li><a href="#background-reading-and-documentation">Background Reading and Documentation</a></li>
<li><a href="#our-motivation">Our motivation</a></li>
<li><a href="#procedure">Procedure</a><ul>
<li><a href="#administrative-commands">Administrative commands</a></li>
<li><a href="#gather-information">Gather information</a></li>
<li><a href="#create-a-partition">Create a Partition</a></li>
<li><a href="#creating-a-physical-volume">Creating a Physical Volume</a></li>
<li><a href="#add-a-physical-volume-to-a-volume-group">Add a Physical Volume to a Volume Group</a></li>
<li><a href="#creating-a-logical-volume">Creating a Logical Volume</a></li>
<li><a href="#creating-a-file-system-for-the-lv">Creating a File System for the LV</a></li>
</ul></li>
</ul></li>
<li><a href="#backups-with-rsync">Backups with <code>rsync</code></a><ul>
<li><a href="#create-a-secondary-hard-drive-in-virtualbox">Create a secondary hard drive in VirtualBox</a></li>
<li><a href="#partition-the-new-hard-drive">Partition the new hard drive</a></li>
<li><a href="#backup-with-rsync">Backup with <code>rsync</code></a></li>
</ul></li>
<li><a href="#managing-software">Managing Software</a><ul>
<li><a href="#lets-install-something">Let’s install something:</a></li>
<li><a href="#dnf-basics">dnf basics</a></li>
</ul></li>
<li><a href="#nat-network-address-translation">NAT (Network Address Translation)</a><ul>
<li><a href="#set-up-nat">Set up NAT</a></li>
</ul></li>
<li><a href="#systemd">systemd</a><ul>
<li><a href="#manage-services">Manage Services</a></li>
<li><a href="#examine-logs">Examine Logs</a></li>
<li><a href="#useful-systemd-commands">Useful Systemd Commands</a></li>
</ul></li>
<li><a href="#managing-users-and-groups">Managing Users and Groups</a><ul>
<li><a href="#the-passwd-file">The passwd file</a></li>
<li><a href="#the-shadow-file">The shadow file</a></li>
<li><a href="#the-group-file">The group file</a></li>
<li><a href="#management-tools">Management Tools</a></li>
<li><a href="#practice-1">Practice</a><ul>
<li><a href="#create-a-new-user-modify-account">Create a new user; modify account</a></li>
<li><a href="#create-a-new-group-add-users-to-the-group">Create a new group; add users to the group</a></li>
<li><a href="#user-account-and-group-deletion">User account and group deletion</a></li>
<li><a href="#another-group-example">Another Group Example</a></li>
</ul></li>
</ul></li>
<li><a href="#networking">Networking</a><ul>
<li><a href="#link-layer">Link Layer</a><ul>
<li><a href="#arp-address-resolution-protocol">ARP (Address Resolution Protocol)</a></li>
</ul></li>
<li><a href="#internet-layer">Internet Layer</a><ul>
<li><a href="#ip-internet-protocol">IP (Internet Protocol)</a></li>
<li><a href="#routing">Routing</a></li>
<li><a href="#using-the-ip-command">Using the <code>ip</code> command</a></li>
<li><a href="#ipv6-subnetting">IPv6 subnetting</a></li>
<li><a href="#icmp">ICMP</a></li>
</ul></li>
<li><a href="#transport-layer">Transport Layer</a></li>
</ul></li>
<li><a href="#some-basic-ip-subnetting">Some basic IP subnetting</a><ul>
<li><a href="#private-ip-ranges">Private IP Ranges</a></li>
<li><a href="#ip-meaning">IP Meaning</a></li>
<li><a href="#ip-math">IP Math</a></li>
<li><a href="#subnetting">Subnetting</a><ul>
<li><a href="#example-1-192.168.1.6-desktop-1-subnet-a">Example 1: 192.168.1.6 : Desktop 1, Subnet A</a></li>
<li><a href="#example-2-10.160.38.75-desktop-1-subnet-b">Example 2: 10.160.38.75 : Desktop 1, Subnet B</a></li>
<li><a href="#example-3-172.16.1.6224">Example 3: 172.16.1.62/24</a></li>
<li><a href="#example-4-10.0.5.2316">Example 4: 10.0.5.23/16</a></li>
</ul></li>
</ul></li>
<li><a href="#introduction-to-dns-the-domain-name-system">Introduction to DNS, the Domain Name System</a><ul>
<li><a href="#dns-intro-videos">DNS Intro Videos</a></li>
<li><a href="#fqdn-the-fully-qualified-domain-name">FQDN: The Fully Qualified Domain Name</a></li>
<li><a href="#root-domain">Root domain</a><ul>
<li><a href="#alternative-dns-root-systems">Alternative DNS root systems</a></li>
</ul></li>
<li><a href="#top-level-domain-tld">Top level domain (TLD)</a></li>
<li><a href="#second-level-domain-names">Second-level domain names</a></li>
<li><a href="#third-level-domain-names-hostnames-subdomains">Third-level domain names / hostnames / subdomains</a></li>
<li><a href="#recursive-and-forward-dns-servers">Recursive and Forward DNS Servers</a></li>
<li><a href="#dns-servers">DNS servers</a></li>
<li><a href="#dns-record-types">DNS Record types</a></li>
<li><a href="#dns-toolbox">DNS Toolbox</a></li>
</ul></li>
<li><a href="#install-dns-server">Install DNS Server</a><ul>
<li><a href="#virtualbox-setup">VirtualBox Setup:</a></li>
<li><a href="#update-server">Update Server</a></li>
<li><a href="#clone-server">Clone Server</a></li>
<li><a href="#fedora-dns-client">Fedora-DNS-Client</a></li>
<li><a href="#fedora-dns-server">Fedora-DNS-Server</a><ul>
<li><a href="#install-and-configure-dns">Install and Configure DNS</a></li>
<li><a href="#set-up-zone-files">Set up zone files</a></li>
</ul></li>
<li><a href="#on-the-client-machine">On the client machine</a></li>
<li><a href="#make-permanent">Make Permanent</a></li>
</ul></li>
<li><a href="#local-security-chroot-example">Local Security: <code>chroot</code> example</a><ul>
<li><a href="#chroot-a-current-user"><code>chroot</code> a current user</a></li>
<li><a href="#exercise">Exercise</a><ul>
<li><a href="#nano-in-chroot">Nano in chroot</a></li>
</ul></li>
</ul></li>
<li><a href="#linux-firewalls">Linux Firewalls</a><ul>
<li><a href="#iptables">iptables</a><ul>
<li><a href="#usage">Usage</a></li>
<li><a href="#allow-connections-only-from-subnet">Allow connections only from subnet</a></li>
<li><a href="#prerouting">PREROUTING</a></li>
<li><a href="#output">OUTPUT</a></li>
</ul></li>
<li><a href="#firewall-cmd">firewall-cmd</a></li>
</ul></li>
<li><a href="#installing-apache2">Installing Apache2</a><ul>
<li><a href="#update-system-first">Update system first</a></li>
<li><a href="#install-httpd">Install <code>httpd</code></a></li>
<li><a href="#basic-checks">Basic checks</a></li>
<li><a href="#creating-a-web-page">Creating a web page</a></li>
<li><a href="#changing-the-hostname">Changing the <code>hostname</code></a></li>
<li><a href="#optional">Optional</a></li>
</ul></li>
<li><a href="#apache2-user-directories">Apache2 User Directories</a><ul>
<li><a href="#enable-userdir-homepublic_html-sites">Enable userdir (<code>$HOME/public_html</code> sites)</a><ul>
<li><a href="#tasks">Tasks</a></li>
<li><a href="#selinux">SELinux</a></li>
<li><a href="#test-1">Test</a></li>
</ul></li>
</ul></li>
<li><a href="#installing-and-setting-php-for-apache">Installing and Setting PHP for Apache</a></li>
<li><a href="#apache2-virtualhosts">Apache2 VirtualHosts</a><ul>
<li><a href="#update-os">Update OS</a></li>
<li><a href="#create-new-configurations">Create new configurations</a></li>
<li><a href="#creating-the-sites">Creating the sites</a></li>
<li><a href="#the-hosts-file-etchosts">The Hosts File: <code>/etc/hosts</code></a></li>
<li><a href="#references">References</a></li>
</ul></li>
<li><a href="#mysql-server-administration">MySQL Server Administration</a><ul>
<li><a href="#install-and-set-up-mysql">Install and Set Up MySQL</a></li>
<li><a href="#secure-mysql-server">Secure MySQL Server</a></li>
<li><a href="#create-and-set-up-a-regular-user-account">Create and Set Up a Regular User Account</a></li>
<li><a href="#create-a-practice-database">Create a Practice Database</a><ul>
<li><a href="#logging-in-as-regular-user-and-creating-tables">Logging in as Regular User and Creating Tables</a></li>
<li><a href="#adding-records-into-the-table">Adding records into the table</a></li>
</ul></li>
<li><a href="#references-and-read-more">References and Read More</a></li>
</ul></li>
<li><a href="#install-php-and-mysql-support">Install PHP and MySQL Support</a><ul>
<li><a href="#create-php-scripts">Create PHP Scripts</a></li>
<li><a href="#check-ip-and-hostname">Check IP and Hostname</a></li>
<li><a href="#references-1">References</a></li>
</ul></li>
</ul>
</nav>
<p><strong>Author:</strong> Sean Burns, PhD<br />
<strong>Title:</strong> Lectures and Demos for Linux Systems Administration<br />
<strong>Date:</strong> Fall 2020<br />
<strong>Email:</strong> sean.burns@uky.edu</p>
<p>Demonstration transcripts for my Fall 2020 Linux Systems Administration Course</p>
<h2 id="history-of-unix-and-linux">History of Unix and Linux</h2>
<h3 id="location-bell-labs-part-of-att-new-jersey-late-1960s-through-early-1970s">Location: Bell Labs, part of AT&amp;T (New Jersey), late 1960s through early 1970s</h3>
<ul>
<li>Multics, a time sharing system (that is, more than one person could use it at once)</li>
<li>Multics had issues and was slowly abandoned</li>
<li><a href="http://cs.bell-labs.co/who/ken/">Ken Thompson</a> found an old PDP-7. Started to write UNIX.</li>
<li>Also, the <code>ed</code> text editor was written. Pronounced e.d. but generally sounded out.</li>
<li>This version of UNIX would later be referred to as <em>Research Unix</em></li>
<li><a href="https://www.bell-labs.com/usr/dmr/www/">Dennis Ritchie</a> joined him and created the C language (In October 2011, Steve Jobs passed away a week before Dennis Ritchie, but the world mourned Jobs and Ritchie’s death went largely unnoticed).</li>
</ul>
<h3 id="location-berkeley-ca-university-of-california-berkeley-early-to-mid-1970s">Location: Berkeley, CA (University of California, Berkeley), early to mid 1970s</h3>
<ul>
<li>The code for UNIX was not ‘free’ but low cost and easily shared.</li>
<li>Ken Thompson visited Berkeley and helped install Version 6 of UNIX (https://en.wikipedia.org/wiki/Berkeley_Software_Distribution).</li>
<li>Bill Joy and others contributed heavily (Joy created vi, which Vim descends from).</li>
<li>This installation of UNIX would eventually become known as the Berkeley Software Distribution, or BSD.</li>
</ul>
<h3 id="att">AT&amp;T</h3>
<ul>
<li>Until its breakup in 1984, AT&amp;T was not allowed to profit off of patents that were not directly related to its telecommunications businesses.</li>
<li>This agreement with the US government helped protect the company from charges of monopoly, and as a result, they could not commercialize UNIX.</li>
<li>This changed after the breakup. System V UNIX became the standard bearer of commercial UNIX.</li>
</ul>
<h3 id="location-boston-ma-mit-early-1980s-through-early-1990s">Location: Boston, MA (MIT), early 1980s through early 1990s</h3>
<ul>
<li>In the late 1970s, <a href="https://en.wikipedia.org/wiki/Richard_Stallman">Richard Stallman</a> began to notice that software began to become commoditized and as a result, hardware vendors were no longer sharing the code they developed to make their hardware work. During much of his education, software code was not eligible for copyright protection (changed under the Copyright Act of 1976).</li>
<li>Stallman, who thrived in a <em>hacker culture</em> (Wikipedia page on Stallman), began to wage battles against this.</li>
<li>Stallman created the <a href="https://www.gnu.org/gnu/gnu.html">GNU project</a> and philosophy (also the creator of GNU Emacs). The project is an attempt to create a completely <strong>free</strong> operating system, that was Unix-like, called GNU.</li>
<li>By the early 1990s, Stallman and others had developed all the utilities needed to have a full operating system, except for a kernel.</li>
<li>This includes the Bash shell, written by <a href="https://opuslogica.com/">Brian Fox</a>.</li>
<li>The philosophy includes several propositions that define free software:</li>
</ul>
<h3 id="the-four-freedoms-per-gnu-project">The four freedoms, per GNU Project</h3>
<p><a href="https://www.gnu.org/philosophy/free-sw.html">https://www.gnu.org/philosophy/free-sw.html</a></p>
<blockquote>
<ol start="0" type="1">
<li>The freedom to run the program as you wish, for any purpose (freedom 0).</li>
<li>The freedom to study how the program works, and change it so it does your computing as you wish (freedom 1). Access to the source code is a precondition for this.</li>
<li>The freedom to redistribute copies so you can help others (freedom 2).</li>
<li>The freedom to distribute copies of your modified versions to others (freedom 3). By doing this you can give the whole community a chance to benefit from your changes. Access to the source code is a precondition for this.</li>
</ol>
</blockquote>
<h3 id="the-unix-wars-and-the-lawsuit">The Unix wars and the lawsuit</h3>
<ul>
<li>Differences in AT&amp;T Unix and BSD Unix arose. The former was aimed at commercialization and the latter aimed at researchers and academics.</li>
<li>UNIX Systems Laboratories, Inc. (USL, part of AT&amp;T) sued Berkeley Software Design, Inc. (BSDi, part of the University of California, Berkeley) for copyright and trademark violations.</li>
<li>USL ultimately lost the case.</li>
</ul>
<h3 id="the-rise-of-linux-linus-torvalds-university-of-helsinki-finland">The Rise of Linux, Linus Torvalds, University of Helsinki, Finland</h3>
<ul>
<li>On August 25, 1991 (28 years ago this last Sunday), [Linus][linux_torvalds] <a href="https://www.kernel.org/">Torvalds</a> announced that he had started working on a <strong>free</strong> operating system kernel for the 386 CPU architecture and for the specific hard drives that he had. This kernel would later be named Linux.</li>
<li>Linux technically refers only to the kernel. An operating system kernel handles startup, devices, memory, resources, etc.</li>
<li>His motivation was to learn about OS development but also to have access to a Unix-like system. He already had access to an Unix-like system called MINIX, but MINIX had some technical and copyright restrictions.</li>
<li>Torvalds has stated that if a BSD or if GNU Hurd were available, then he may not have created the Linux kernel.</li>
<li>But Torvalds and others took the GNU utilities and created what is now called Linux, or GNU/Linux.</li>
</ul>
<h3 id="distributions">Distributions</h3>
<ul>
<li>Soon after Linux development, people would create their own Linux and GNU based operating systems and would distribute.</li>
<li>As such, they became referred to as <em>distributions</em>.</li>
<li>The two oldest distributions that are still in active development include:
<ul>
<li>Slackware</li>
<li>Debian</li>
</ul></li>
</ul>
<h3 id="what-happened-to-bsd">What happened to BSD?</h3>
<ul>
<li>Unix version numbers 1-6 eventually led to BSD 1-4.</li>
<li>At BSD 4.3, all versions had some AT&amp;T code. Desire to remove this code led to BSD Net/1.</li>
<li>All AT&amp;T code was removed by BSD Net/2.</li>
<li>BSD Net/2 was ported to the Intel 386 processor. This became 386BSD and was made available a year after the Linux kernel was released, in 1992.</li>
<li>386BSD split into two projects:
<ul>
<li>NetBSD</li>
<li>FreeBSd</li>
</ul></li>
<li>NetBSD split into another project: OpenBSD.</li>
<li>All three of these BSDs are still in active development. From a bird’s eye point of view, they each have different foci:
<ul>
<li><a href="https://www.netbsd.org/">NetBSD</a> focuses on portability (MacOS, NASA)</li>
<li><a href="https://www.freebsd.org/">FreeBSD</a> focuses on wide applicability (WhatsApp, Netflix, PlayStation 4, MacOS)</li>
<li><a href="https://www.openbsd.org/">OpenBSD</a> focuses on security (has contributed a number of very important applications)</li>
</ul></li>
</ul>
<p>Note: MacOS is based on [Darwin][puredarwin], is <a href="https://www.opengroup.org/membership/forums/platform/unix">technically UNIX</a>, and is partly based on FreeBSD with some code coming from the other BSDs.</p>
<h3 id="what-happened-with-gnu">What happened with GNU?</h3>
<ul>
<li>The GNU Hurd is still being developed, but it’s only in the pre-production state. The last release was 0.9 on December 2016. A complete OS based on the GNU Hurd can be downloaded and ran.</li>
</ul>
<h3 id="free-and-open-source-licenses">Free and Open Source Licenses</h3>
<ul>
<li><a href="https://www.gnu.org/software/hurd/">GNU General Public License (GPL)</a></li>
<li><a href="https://opensource.org/licenses/BSD-3-Clause">BSD License</a></li>
</ul>
<h2 id="the-linuxunix-file-system-and-file-types">The Linux/Unix File System and File Types</h2>
<ul>
<li><code>tree</code> : list contents of directories in a tree-like format
<ul>
<li><code>tree -dfL 1</code> : dir only, full path, one level</li>
</ul></li>
</ul>
<h3 id="the-root-directories">The root directories</h3>
<ul>
<li><code>/bin</code> : binary files needed to use the system</li>
<li><code>/boot</code> : files needed to boot the system</li>
<li><code>/dev</code> : device files – all hardware has a file</li>
<li><code>/etc</code> : system configuration files</li>
<li><code>/home</code> : user directories</li>
<li><code>/lib</code> : libraries/programs needed for other programs</li>
<li><code>/media</code> : external storage is mounted</li>
<li><code>/mnt</code> : other file systems may be mounted</li>
<li><code>/opt</code> : store software code to compile software</li>
<li><code>/proc</code> : files containing info about your computer</li>
<li><code>/root</code> : home directory of superuser</li>
<li><code>/run</code> : used by system processes</li>
<li><code>/sbin</code> : like <code>/bin</code>, binary files that require superuser privs</li>
<li><code>/usr</code> : user binaries, etc that might be installed by users</li>
<li><code>/srv</code> : contains data for servers</li>
<li><code>/sys</code> : contains info about devices</li>
<li><code>/tmp</code> : temp files used by applications</li>
<li><code>/var</code> : variable files, used often for system logs</li>
</ul>
<p>Source: <a href="https://www.linux.com/tutorials/linux-filesystem-explained/">Linux Filesystem Explained</a></p>
<h2 id="gnu-coreutils">GNU Coreutils</h2>
<p>The GNU Coreutils, or the GNU Core Utilities, “are the basic file, shell and text manipulation utilities of the GNU operating system. These are the core utilities which are expected to exist on every operating system” (<a href="https://www.gnu.org/software/coreutils/">Coreutils, GNU</a>).</p>
<p>In order to do good work on the command line, it’s essential that we become familiar with these utilities that cover a range of commands.</p>
<p>The online manual is located at <a href="https://www.gnu.org/software/coreutils/manual/coreutils.html">GNU Coreutils Manual</a>. Read through it and practice! Look for examples on the web. The commands below were picked from the above online manual. Their descriptions were copied from the man page. E.g.:</p>
<pre><code>man -f cat
cat (1)              - concatenate files and print on the standard output</code></pre>
<p>We’ll use the <strong>cities.txt</strong> file and the <strong>capitals.txt</strong> files in this tutorial. You will find both of these files in the home directory on our remote server.</p>
<p>Here are what the files look like:</p>
<pre><code>$ cat cities.txt
lexington, ky, 383780, 1775
knoxville, tn, 178874, 1791
new york city, ny, 8623000, 1624
lansing, mi, 116986, 1859
san diego, ca, 1420000, 1769
huntsville, al, 194585, 1809
columbia, mo, 121717, 1821

$ cat capitals.txt
franfort, ky
nashville, tn
albany, ny
lansing, mi
sacramento, ca
montgomery, al
jefferson city, mo</code></pre>
<h3 id="practice-and-examples">Practice and examples</h3>
<p>Now you can test some of these commands on these files. Be sure to read their respective manual pages for their available options. In order to read the manual page, you type the command <code>man</code> followed by the name of the command that you’re interested in reading about, like <code>man cat</code>. You can navigate the manual pages using your cursor keys and to exit them, you press <code>q</code>.</p>
<h4 id="output-entire-files">Output entire files</h4>
<ul>
<li><code>cat</code> : concatenate files and print on the standard output
<ul>
<li><code>cat cities.txt</code></li>
<li><code>cat cities.txt capitals.txt</code></li>
</ul></li>
<li><code>tac</code> : concatenate and print files in reverse
<ul>
<li><code>tac cities.txt</code></li>
</ul></li>
<li><code>nl</code> : add line numbers to files
<ul>
<li><code>nl capitals.txt</code></li>
</ul></li>
</ul>
<h4 id="formatting-file-contents">Formatting file contents</h4>
<ul>
<li><code>fmt</code> : simple optimal text formatter
<ul>
<li><code>man fmt</code></li>
<li><code>fmt -w 50 file.txt</code></li>
</ul></li>
</ul>
<h4 id="output-of-parts-of-files">Output of parts of files</h4>
<ul>
<li><code>head</code> : output the first part of files
<ul>
<li><code>head file.txt</code></li>
<li><code>head -n1 file.txt</code></li>
<li><code>fmt -w 50 file.txt | head -n1</code></li>
</ul></li>
<li><code>tail</code> : output the last part of files
<ul>
<li><code>tail file.txt</code></li>
<li><code>tail -n1 file.txt</code></li>
<li><code>fmt -w 50 file.txt | tail -n1</code></li>
</ul></li>
</ul>
<h4 id="summarizing-files">Summarizing files</h4>
<ul>
<li><code>wc</code> : print newline, word, and byte counts for each file
<ul>
<li><code>wc -w cities.txt</code></li>
<li><code>wc -l cities.txt</code></li>
</ul></li>
<li><code>md5sum</code> : compute and check MD5 message digest</li>
<li><code>sha256sum</code> : compute and check SHA256 message digest</li>
</ul>
<h4 id="operating-on-sorted-files">Operating on sorted files</h4>
<ul>
<li><code>sort</code> : sort lines of text files
<ul>
<li><code>sort cities.txt</code></li>
</ul></li>
</ul>
<p>This does a numerical sort of the cities.txt file by the fourth column, which is date founded column. Specifically: <code>-t</code> declares the field separator (,). <code>-k</code> declares the key (the sorting ID). So we’ll sort by first column, second column, third column, and then fourth column, where column is defined by the comma key:</p>
<pre><code>sort -t , -k 1 cities.txt
sort -t , -k 2 cities.txt
sort -t , -k 3 cities.txt
sort -t , -k 4 cities.txt</code></pre>
<ul>
<li><code>uniq</code> : report or omit repeated lines
<ul>
<li><code>sort file2.txt | uniq</code></li>
<li><code>sort file2.txt | uniq -c</code></li>
<li><code>sort -u file2.txt</code> # skipping sort</li>
</ul></li>
</ul>
<h4 id="operating-on-fields">Operating on fields</h4>
<ul>
<li><code>cut</code> : remove sections from each line of files</li>
</ul>
<p>This establishes the comma as the deliminator (field separator) and prints out the second field of the cities.txt file, which is the list of states. Here the field separator is <code>-d</code> and the key indicator is declared with <code>-f</code>. This line cuts the second field out:</p>
<pre><code>cut -d, -f2 cities.txt</code></pre>
<ul>
<li><code>paste</code> : merge lines of files</li>
</ul>
<p>Our goal here is to create output that only reports the city and state names. In the fourth line, I use what’s called <a href="https://tldp.org/LDP/abs/html/process-sub.html">process substitution</a>. This applies the <code>fmt</code> command on the output of the command (or process) in the parentheses.</p>
<pre><code>cut -d, -f1 cities.txt &gt; city_names.txt
cut -d, -f2 cities.txt &gt; state_names.txt
paste city_names.txt state_names.txt
fmt &lt;(paste city_names.txt state_names.txt)
rm city_names.txt state_names.txt</code></pre>
<p>Again using <strong>process substitution</strong>, we can do the above with one line and avoid creating extra files like <em>city_names.txt</em> and <em>state_names.txt</em>:</p>
<pre><code>paste -d, &lt;(cut -d, -f1 cities.txt) &lt;(cut -d, -f2 cities.txt)</code></pre>
<ul>
<li><code>join</code> : join lines of two files on a common field</li>
</ul>
<p>The <code>join</code> command generally requires files to be sorted first. Using the same kind of logic as we did above, by redirecting standard output to temp files and then joining them based on the unique column of data in each one, which is the state column, happens to be column two in both <strong>cities.txt</strong> and <strong>capitals.txt</strong>. The <code>join</code> command declares the first file with <code>-1</code> and the second column in that file with <code>2</code>. Then the second file with <code>-2</code> and the second column in the second file with <code>2</code>.</p>
<pre><code>sort -t, -k2 cities.txt &gt; cities_sorted.txt
sort -t, -k2 capitals.txt &gt; capitals_sorted.txt
join -t, -1 2 -2 2 cities_sorted.txt capitals_sorted.txt &gt; tables.txt
cat tables.txt
rm cities_sorted.txt capitals_sorted.txt</code></pre>
<p>Or, using <strong>process substitution</strong> again, we can make this a one-liner, albeit a long line:</p>
<pre><code>join -t, -1 2 -2 2 &lt;(sort -t, -k2 cities.txt) &lt;(sort -t, -k2 capitals.txt) &gt; tables.txt</code></pre>
<h4 id="operating-on-characters">Operating on characters</h4>
<ul>
<li><code>tr</code> : translate or delete characters</li>
</ul>
<p>The <code>tr</code> command requires that we redirect standard input from a file, but we can also do it from the screen.</p>
<p>Capitalize all the words in a file called ‘tables.txt’:</p>
<pre><code>tr a-z A-Z &lt; tables.txt</code></pre>
<p>Or, capitalize all the words after we them in on the screen. After you’ve written the last line (below it’s ‘thanks’), press control-D and the output will be converted:</p>
<pre><code>tr a-z A-Z | cat
hello
how are you
thanks
HELLO
HOW ARE YOU
THANKS</code></pre>
<p>Translate commas into newlines first and then tabs next:</p>
<pre><code>tr , &#39;\n&#39; &lt; tables.txt
tr , &#39;\t&#39; &lt; tables.txt</code></pre>
<p>Delete all numerals:</p>
<pre><code>tr -d 0-9 &lt; tables.txt</code></pre>
<p>Convert tabs to spaces, or vice versa:</p>
<ul>
<li><code>expand</code> : convert tabs to spaces</li>
<li><code>unexpand</code> : convert spaces to tabs</li>
</ul>
<pre><code>tr , &#39;\t&#39; &lt; tables.txt &gt; tables2.txt
expand tables2.txt &gt; tables3.txt
tr -d &#39;\t&#39; &lt; tables2.txt   # these are tabs so they&#39;re deleted
tr -d &#39;\t&#39; &lt; tables3.txt   # these aren&#39;t tab so not deleted</code></pre>
<h1 id="quick-ssh-connect">Quick SSH Connect</h1>
<p>Later in the semester, each of you will install virtual machine software so that you can install a Linux operating system and manage it on your own computer. Until then, we will need to connect to a remote server in order to acquire some basic Linux command line skills. To do that, we will use what is called <a href="https://en.wikipedia.org/wiki/Secure_Shell">SSH</a>, or <a href="https://www.openssh.com/">Secure Shell</a>.</p>
<p>How you use SSH will depend on which operating system or OS version you are using. If you are using a macOS computer, then everything I do in this video will be exactly the same for you. Use SpotLight to search for the <em>terminal.app</em> and open it. You will see a command line prompt similar to mine (although by default, I think macOS uses black text on a white background, but you can configure this in the app preferences).</p>
<p>If you are on a Windows machine, then I hope you are using version 10. If so, then you can install a <em>SSH client</em>. I don’t use Windows and can’t create a video for you, but I found one that looks pretty helpful. Follow the instructions in that video and see if it works for you. Alternatively, below is a link to some other instructions. I am not sure which one is more current, but between the two, you should be able to figure it out:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=xIfzZXHaCzQ">How to enable and install Built-in SSH in Windows 10 using the windows command prompt or powershell</a></li>
<li><a href="https://www.howtogeek.com/336775/how-to-enable-and-use-windows-10s-built-in-ssh-commands/">How to Enable and Use Windows 10’s New Built-in SSH Commands</a></li>
</ul>
<p>If neither of those work for you, then you should install <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY</a>. This is a great app, and since it’s available on Linux, I will show you how to use it in this video.</p>
<h2 id="linux-and-macos">Linux and macOS</h2>
<ul>
<li>Open terminal</li>
<li>type: <code>ssh username@ip-address</code></li>
<li>Enter your password</li>
<li>type <code>less README</code></li>
<li>press <code>q</code></li>
<li>type <code>exit</code> to exit the session</li>
</ul>
<h2 id="windows-with-putty">Windows with PuTTY</h2>
<ul>
<li>Open PuTTY</li>
<li>Enter IP Address in field marked <em>Host Name (or IP address)</em></li>
<li>Click Open at the bottom</li>
<li>Enter your username at the prompt: <code>login as:</code></li>
<li>Enter your password</li>
<li>type <code>less README</code></li>
<li>press <code>q</code></li>
<li>type <code>exit</code> to exit the session</li>
</ul>
<h2 id="putty-configuration">PuTTY Configuration</h2>
<p>If you use PuTTY, then you can configure font size and screen colors, if you want. The default font size is too small for me, and so that’s something I’d change right away. To change the font size, in the PuTTY window:</p>
<ul>
<li>Click on <em>Fonts</em> under the <em>Window</em> category</li>
<li>Click on <em>Change…</em> next to the item labeled <em>Font used for ordinary text</em>.</li>
<li>Select the font and size that you prefer</li>
</ul>
<p>That’s all for today. Keep these notes and next week we start to connect to our remote Linux server in order to learn some command line basics.</p>
<h1 id="learning-bash">Learning Bash</h1>
<p>Let’s cover some basic commands. I’ll list them and go through each one below.</p>
<h2 id="navigation">Navigation</h2>
<ul>
<li><code>pwd</code> : print working directory</li>
<li><code>ls</code> : list directory contents</li>
<li><code>cd</code> : change the shell working directory</li>
<li>absolute paths: <code>/home/sean/public_html/</code></li>
<li>relative paths:</li>
</ul>
<pre><code>pwd
/home/sean/
mkdir testdir
cd testdir
pwd
/home/sean/testdir
cd /home/sean/public_html/ # changing directory using absolute paths
cd ../testdir/ # changing directory using relative paths</code></pre>
<h2 id="file-names">File names</h2>
<ul>
<li>everything is a file: <code>file</code></li>
<li>case sensitive</li>
<li>no spaces in names
<ul>
<li>if do, then quote</li>
<li>if do, then use backslashes</li>
</ul></li>
<li>hidden files: <code>ls -a</code></li>
</ul>
<h2 id="manual-pages">Manual pages</h2>
<ul>
<li><code>man ls</code></li>
<li><code>man -k [search term]</code></li>
<li><code>info</code> e.g., <code>info sed</code></li>
</ul>
<h2 id="file-manipulation">File manipulation</h2>
<ul>
<li><code>mkdir</code> : make or create a directory</li>
<li><code>rmdir</code> : remove or delete empty directories</li>
<li><code>touch</code> : change file timestamps (also, create an empty file)</li>
<li><code>cp [source] [destination]</code> : copy files and directories</li>
<li><code>mv [source] [destination]</code> : move (rename) files</li>
<li><code>rm</code> remove files or directories</li>
<li><code>rm -rf</code> for removing a directory with content</li>
</ul>
<h2 id="reading-files">Reading Files</h2>
<ul>
<li><code>more</code> : file perusal filter for viewing</li>
<li><code>less</code> : opposite of more</li>
<li><code>cat</code> : concatenate files and print on the standard output</li>
</ul>
<h2 id="creating-output">Creating Output</h2>
<ul>
<li><code>echo</code> : display a line of text</li>
</ul>
<h3 id="practice">Practice</h3>
<p>Try using all the commands above this week.</p>
<p>Please visit: <a href="https://ryanstutorials.net/linuxtutorial/">https://ryanstutorials.net/linuxtutorial/</a> for some good additional tutorials if you want to keep exploring. For now, practice the above and we’ll extend on these commands next week.</p>
<h1 id="bash-scripting">Bash Scripting</h1>
<p>In this demo, I’ll discuss the following three topics:</p>
<ul>
<li>File Ownership and Permissions</li>
<li>Grep and Regular Expressions</li>
<li>Test command and <code>if</code> Statements</li>
</ul>
<h2 id="file-ownership-and-permissions">File Ownership and Permissions</h2>
<p>All files in Linux have permissions that control whether the files can be read, modified (edited), or executed if they are scripts/programs or if they are directories. Directories need to have execute permissions in order to change into them with the <code>cd</code> command. Additionally, all files in Linux have ownership settings that control user ownership and group ownership.</p>
<p>We can examine the permission and owner settings with the <code>ls -l</code> command and option. In the following example, I have two regular files called <strong>capitals.txt</strong> and <strong>cities.txt</strong> and two directories called <strong>documents</strong> and <strong>public_html</strong>:</p>
<pre><code>$ ls -lh
-rw-rw-r--  1 sean sean    0 Aug 21 00:28 capitals.txt
-rw-rw-r--  1 sean sean    0 Aug 21 00:28 cities.txt
drwx------  2 sean sean 4.0K Aug 25 18:35 documents
drwxrwxr-x  1 sean sean 4.0K Aug 25 18:35 public_html</code></pre>
<p>The ownership of the file is declared in the two columns where my user name is listed:</p>
<pre><code>sean sean</code></pre>
<p>It states that the user <code>sean</code> (column 1) owns the file and the group <code>sean</code> (column 2) is the group owner of the file. Each of you are a member of a group that has the same name as your username. You are also a member of a student group <code>sis_students</code>. You can see which groups you are in with the <code>groups</code> command:</p>
<pre><code>groups</code></pre>
<p>The permissions are stated in the above command with the string of characters that include <code>rwx</code>, which may be repeated up to three times. Each set of <code>rwx</code> values represents file permissions for three different entities:</p>
<ol type="1">
<li>First set: the first set of <code>rwx</code> represents <strong>r</strong>ead, <strong>w</strong>rite, and <strong>x</strong>ecute permissions for the <strong>u</strong>ser who owns of the file or directory.</li>
<li>Second set: the second set of <code>rwx</code> represents read, write, and execute permissions for the <strong>g</strong>roup owner of the file or directory.</li>
<li>Third set: this set controls access for all <strong>o</strong>thers.</li>
</ol>
<p>To read the file permissions for <strong>capitals.txt</strong> file, we read them from left to right:</p>
<p>-rw-rw-r–</p>
<ul>
<li>The first <code>rw-</code> states that the user who owns the file has <strong>Read</strong> and <strong>Write</strong> access but not <code>x</code> execute access since this is marked with a <code>-</code></li>
<li>The second <code>rw-</code> states that the group that owns the file has <strong>Read</strong> and <strong>Write</strong> access but not <code>x</code> execute access since this is marked with a <code>-</code></li>
<li>The third <code>r--</code> states that all others have <strong>Read</strong> access but not <code>wx</code> <strong>Write</strong> or <strong>Execute</strong> access since this is marked with <code>--</code></li>
</ul>
<p>In order to change ownership of the file, we use the <code>chown</code> command, and to change file permissions, we use the <code>chmod</code> command.</p>
<p>If I want to change the group ownership of the <strong>capitals.txt</strong> file so that members of my faculty group can access it, then the command to do so is:</p>
<pre><code>chown sean:sis_fac_staff capitals.txt</code></pre>
<pre><code>ls -l </code></pre>
<p>And the new output is:</p>
<pre><code>-rw-rw-r--  1 sean sis_fac_staff 0 Aug 21 00:28 capitals.txt</code></pre>
<p>If I want to revert it back, then:</p>
<pre><code>chown sean:sean capitals.txt</code></pre>
<p>Changing file permissions is trickier. But note those letters that are in bold above in the transcript. I marked those letters because they are used in the <code>chmod</code> command to change the file permissions for the user owner, group owner, and other file permissions. There is also an <strong>a</strong> option for <strong>all</strong> three sets of permissions.</p>
<p>For example, to remove Write access to the file for all users and thus make the file read-only:</p>
<pre><code>chmod a-w capitals.txt</code></pre>
<p>Thus <code>a-w</code> means for <strong>a</strong>ll users, remove <strong>W</strong>rite access.</p>
<p>If I wanted to make the file executable for me only, since <code>sean</code> is the owner of the file:</p>
<pre><code>chmod u+x capitals.txt</code></pre>
<p>Here <code>u+x</code> means for the <strong>u</strong>ser that is the owner of the file, make the file executable. This is helpful in case this is a Bash script.</p>
<p>I can also combine letters. If I want to make the file <strong>w</strong>ritable by the <strong>u</strong>ser that owns the file and the <strong>g</strong>roup that owns the file:</p>
<pre><code>chmod ug+w capitals.txt</code></pre>
<h2 id="grep-and-regular-expressions">Grep and Regular Expressions</h2>
<p>Oftentimes, as systems administrators, we will need to search the contents of a file. The command that we use to do that is the <code>grep</code> command. Using the <code>grep</code> command is not unlike doing any kind of search, such as in Google. The command simply involves running <code>grep</code> along with the search string and against a file. So if I wanted to search the <strong>capitals.txt</strong> file for the search string <strong>Lexington</strong>, then I do this:</p>
<pre><code>grep &quot;lexington&quot; cities.txt</code></pre>
<h3 id="whole-words-case-sensitive-by-default">Whole words, case sensitive by default</h3>
<p>However, <code>grep</code> is stricter than a Google search. Since the contents of <strong>cities.txt</strong> are all in lowercase, if I run the above command with the city named capitalized, then <code>grep</code> will return nothing:</p>
<pre><code>grep &quot;Lexington&quot; cities.txt</code></pre>
<p>In order to tell grep to ignore case, then I need to use the <code>-i</code> option. This is a reminder for you to run <code>man grep</code> and to read through the documentation and see what the various options are for this command.</p>
<pre><code>grep -i &quot;Lexington&quot; cities.txt</code></pre>
<h3 id="character-classes-and-bracket-expressions">Character Classes and Bracket Expressions</h3>
<p>We can use what are called <strong>character classes</strong> and <strong>bracket expressions</strong> to search for patterns in the text. Here again <code>man grep</code> is very important:</p>
<pre><code>grep [a-d] cities.txt # matches any characters in the range a,b,c,d
grep [^a-d] cities.txt # matches any characters not in the range a,b,c,d
grep [1-3] cities.txt # matches any numbers in the range 1,2,3
grep [^1-3] cities.txt # matches any numbers not in the range 1,2,3
grep [[:alpha:]] cities.txt
grep [^[:alpha:]] cities.txt
grep [[:lower:]] cities.txt
grep [^[:lower:]] cities.txt
grep [[:upper:]] cities.txt
grep [^[:upper:]] cities.txt
grep [[:digit:]] cities.txt
grep [^[:digit:]] cities.txt</code></pre>
<h3 id="anchoring">Anchoring</h3>
<p>From the <code>man</code> page for <code>grep</code>, the use of the caret <strong>^</strong> (outside of character classes and bracket expressions) is used to mark the beginning of a line, and the use of the <strong>$</strong> is used to match the end of a line:</p>
<pre><code>grep &quot;^l&quot; cities.txt # all lines beginning with a &quot;l&quot;
grep &quot;9$&quot; cities.txt # all lines ending with the number &quot;9&quot;</code></pre>
<h3 id="repetition">Repetition</h3>
<p>If we want to repeat regular expressions (the patterns in a text file), then we can use certain repetition operators. The most useful one is the <code>*</code> asterisk and the two curly bracket examples below:</p>
<pre><code>grep &quot;l*&quot; cities.txt # the preceding item &quot;l&quot; matched zero or more times
grep -E &quot;l{2}&quot; cities.txt # the preceding item &quot;l&quot; is matched exactly 2 times
grep -E &quot;l{2,}&quot; cities.txt # the preceding item &quot;l&quot; is matched 2 or more times</code></pre>
<h3 id="alternation">Alternation</h3>
<p>Here we search for either <strong>lexington</strong> or <strong>lansing</strong>. Since they both appear in the file, both lines that contain them are returned:</p>
<pre><code>grep &quot;lexington\|lansing&quot; cities.txt</code></pre>
<p>This alternation works like a Boolean OR statement, which means it’ll return one or the other or both if one is True, the alternate is True, or both are True. If we repeat this line with a city name that is not in the file, but with one that is, then it’ll return the city name that is in the file since at least that is True:</p>
<pre><code>grep &quot;lexington\|london&quot; cities.txt</code></pre>
<h2 id="test-command-and-if-statements">Test Command and <code>if</code> Statements</h2>
<h3 id="test">Test</h3>
<p>Sometime we want to run a test to see if a file exists, or not, or has some special characteristic. In this case, we can use the <code>test</code> command. This command does not have a <code>man</code> page because it is a Bash <strong>builtin</strong>. Therefore to read its documentation, we use the <code>help</code> command for Bash builtins:</p>
<pre><code>help test | less</code></pre>
<p>The <code>[[ -a FILE ]]</code> operators returns <strong>True if file exists</strong> even though it doesn’t print anything to the screen by default. But we can test the logic and have it print something to the screen depending on the outcome of the logic.</p>
<p>In the following two lines, both of the commands will return <strong>“yes the file exists”</strong> because the second command runs regardless of the output of the first command. The semicolon simply allows us to run two commands on one line and even though <strong>helloworld.txt</strong> doesn’t exist in this directory.</p>
<pre><code>[[ -a cities.txt ]] ; echo &quot;yes the file exists&quot;
[[ -a helloworld.txt ]] ; echo &quot;yes the file exists&quot;</code></pre>
<p>To make the second command run <strong>if and only if</strong> the first command succeeds, we use the Boolean <code>&amp;&amp;</code> control operator. Basically, if the first part of the command succeeds (the command before the <code>&amp;&amp;</code>), then run the second part of the command.</p>
<pre><code>[[ -a cities.txt ]] &amp;&amp; echo &quot;yes the file exists&quot;
[[ -a helloworld.txt ]] &amp;&amp; echo &quot;yes the file exists&quot;</code></pre>
<p>Since the <strong>cities.txt</strong> file exists, then the second part of the command is executed and <strong>“yes the file exists”</strong> is printed to the screen. Since the <strong>helloworld.txt</strong> file does not exist, the second part of the command is not executed and nothing is printed to the screen.</p>
<p>We can perform other file operations. For example, to test if one file is newer or older than an other:</p>
<pre><code>[[ cities.txt -nt capitals.txt ]] &amp;&amp; echo &quot;yes&quot;
[[ cities.txt -ot capitals.txt ]] &amp;&amp; echo &quot;yes&quot;</code></pre>
<p>To test if a number is greater or lesser than another number:</p>
<pre><code>[[ $(expr 4 + 3) -gt $(expr 2 + 1) ]] &amp;&amp; echo &quot;yes&quot;</code></pre>
<p>We use two vertical bars <code>||</code> to test the opposite of the <code>&amp;&amp;</code> control operator. Basically, if the first part of the command does not succeed, then run the second command. Thus, this will create the <strong>homework.txt</strong> file <strong>if and only if</strong> the file <strong>does not</strong> exist since the <code>-a</code> file operator tests if a file exists:</p>
<pre><code>[[ -a homework.txt ]] || touch homework.txt</code></pre>
<h3 id="if-statements"><code>if</code> Statements</h3>
<p>The <code>if</code> statement offers an alternative way to do this. When using <code>if</code> statements, it’s helpful to open up <code>nano</code> and add them to a file, but for now, let me show you a multi-line statement at the Bash prompt. Note that the command prompt changes when pressing Enter. This signifies a continuation of the command:</p>
<pre><code>if [[ cities.txt -nt capitals.txt ]] ; then
  echo &quot;cities.txt is newer than capitals.txt&quot;
else
  echo &quot;capitals.txt is newer than cities.txt&quot;
fi</code></pre>
<p>If we were to add that to a file, then we need to add what’s called a <strong>shebang</strong> at the top of the file, which looks like this: <code>#!/bin/bash</code>. This tells the Bash shell that this file is a Bash script. Since we’re adding the above <code>if</code> statement to a file, we might as well modify it. What this script will do is test if <strong>cities.txt</strong> is newer than <strong>capitals.txt</strong>, and if it’s not, it’ll run the <code>touch</code> command, which modifies the file’s timestamp to the current time, and if that’s successful, because of the double ampersands <code>&amp;&amp;</code>, then it’ll echo the next echo statement:</p>
<pre><code>#!/bin/bash

# This is a comment.
# This script tests if cities.txt is newer than capitals.txt

if [[ cities.txt -nt capitals.txt ]] ; then
  echo &quot;cities.txt is newer than capitals.txt&quot;
else
  touch cities.txt &amp;&amp; echo &quot;cities.txt is now newer than capitals.txt&quot;
fi</code></pre>
<p>When we add this in <code>nano</code>, let’s save the file as <strong>filecomp.sh</strong> in <code>nano</code> and make it executable.</p>
<pre><code>chmod u+x filecomp.sh</code></pre>
<p>Then run the script:</p>
<pre><code>./filecomp.sh</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>In this lesson I demoed the following three topics:</p>
<ul>
<li>File Ownership and Permissions</li>
<li>Grep and Regular Expressions</li>
<li>Test command and <code>if</code> Statements</li>
</ul>
<p>Now it’s your turn to practice these.</p>
<h1 id="text-editors">Text editors</h1>
<p>In addition to writing commands at the command prompt, we can also write commands (and other kinds of text) in text editors, save those files as scripts, and then execute the files so that the commands in the script run. This process can save lots of time, especially when we find ourselves writing longer commands. We can enter long commands at the command prompt, but it is difficult to fix errors when writing multi-line commands there.</p>
<p>It’s important to have some familiarity with command line text editors not just because we may need to write out longer scripts, but also because command line text editors may be the primary way we have of modifying configuration files on a server. We’ll learn more about configuration files later in the semester, but these are files, often in the <code>/etc/</code> directory, which define the parameters of various services on a server, such as how a web server delivers web sites or how a firewall blocks certain kinds of internet connections. Graphical based text editors can be nice, but graphical user environments are not always available on servers because of the computer resources they require, which are better used for the purposes of the server, and because the security bugs that come with graphical user software unnecessarily increase the <a href="https://en.wikipedia.org/wiki/Attack_surface">attack surface</a> of the server.</p>
<p>In this demo, I am going to address three text editor programs and I will start with the most difficult one to learn (<code>ed</code>) and end with the easiest one to learn (<code>nano</code>). For this course, I suggest that you use <code>nano</code>, but the first two text editors, <code>ed</code> and <code>vim</code>, are very much a part of Unix and Linux culture. I want you to be familiar with them for that reason but also because their basic designs have influenced a lot of other common technologies.</p>
<h2 id="ed"><code>ed</code></h2>
<p><code>ed</code> is specifically a line editor, and it’s the most likely text editor to be installed on a Linux distribution (<code>nano</code> is also common). <code>ed</code>, or an early version of it, is also the first text editor for the Unix operating system and was developed by Ken Thompson, one of the Unix creators, in the late 1960s. It was written without computer monitors in mind, because those were still uncommon, and instead for <a href="https://en.wikipedia.org/wiki/Teleprinter">teletypewriters (TTYs)</a> and <a href="https://www.youtube.com/watch?v=2B-U-5ylvWo">printers</a>. If you visit that second link, what you will essentially see is the terminal interface from those earlier days, and it is the same basic interface you’re using when you use your terminal applications, which are now virtualised versions of those old teletypewriters. It’s a testament of the power of the terminal that advanced computer users still use the same basic technology today.</p>
<p>In practice, when we use a line editor like <code>ed</code>, the main process of entering text is like any other editor. The big difference is when we need to manipulate the text. In a graphical based text editor, if we want to delete a word or edit some text, we might just backspace over the text or highlight a word and delete it. In a line editor, we manipulate text by referring to lines or across multiple lines and then run commands on the text in those line(s). To operationalize this, this means that each line has an <strong>address</strong>, and the address for line 7 is, for example, <strong>7</strong>, and so forth.</p>
<p>Line editors like <code>ed</code> are command driven. There is no menu to select from at the top of the <em>window</em>. Instead, if a user wants to delete a word, the user first has to direct the line editor to the relevant line by its address and then command the line editor to delete the word on that line. Line editors can also work on ranges of line, including all the lines in the file.</p>
<p>Commands are cryptic in line editors and usually are called by a single letter. For example, to delete a line in <code>ed</code>, we use the <strong>d</strong> command. To print a line, we use the <strong>p</strong> command. To <strong>substitute</strong> (or replace) a word in a line, we use the <strong>s</strong> command. If I wanted to delete line 7 in <code>ed</code>, I’d first enter the address and then the <strong>d</strong> command at the <code>ed</code> prompt:</p>
<pre><code>7d</code></pre>
<p>And to print it, I would enter the address and then the <strong>p</strong> command:</p>
<pre><code>7p</code></pre>
<p>Substituting a word is a tiny bit more complicated because it involves first addressing the line and then searching the line for the word to substitute. This process means that there is a bit more to the command. Here the syntax is:</p>
<pre><code>[ADDRESS[,ADDRESS]]COMMAND[PARAMETERS]</code></pre>
<p>The square brackets in this format example are not used in the actual commands but only to demarcate the parts of the command. The first ADDRESS is required, but the second ADDRESS is optional and would be used only if I wanted to indicate a range of lines. The COMMAND is stated, and if additional parameters are needed, then those are optional. Imagine then that on line 7, I had the following sentence:</p>
<pre><code>I use linux.</code></pre>
<p>Now imagine that I am editing the file and realize that the word <strong>linux</strong> is a proper noun and should be capitalized. The substitute command requires that I first <strong>address</strong> line 7, then state the command <strong>s</strong>, and then search for the word <strong>linux</strong>, and then replace it with the word <strong>Linux</strong>.</p>
<pre><code>7s/linux/Linux/</code></pre>
<p>You can see that the operation we’re doing is familiar to you already because it’s like finding and replacing text in a word processor:</p>
<pre><code>7s/find/replace/</code></pre>
<p>If I wanted to substitute or replace the word <strong>linux</strong> with <strong>Linux</strong> on lines 5-7, then I’d indicate that on the <strong>address range</strong> by typing <code>5,7</code>, which <code>ed</code> interprets as lines 5, 6, 7 (like <strong>5-7</strong>):</p>
<pre><code>5,7s/linux/Linux/</code></pre>
<p>Line editors like <code>ed</code> are also modal, which means they have separate <a href="https://en.wikipedia.org/wiki/Mode_(user_interface)">modes</a> for inputting text and for issuing commands on text. Text editors in graphical user environments, like Notepad on Microsoft Windows or TextEdit on macOS, are <strong>modeless</strong>—the user can switch between writing text and editing text without changing the environment and by using keyboard shortcuts (like Ctrl-c or Cmd-c to copy) or using the menu bar. But in modal text editors, <code>vim</code> included, the user has to enter one mode to write text (the <strong>input mode</strong>) and another mode to run commands on the text (the <strong>command mode</strong>) (<code>vim</code> has many modes but three main ones).</p>
<p>To start with ed, I simply type <code>ed</code> on the Bash prompt followed by an optional file name to work on, which could be a new file or an existing file. Let’s say I wanted to create a file called <strong>letter.txt</strong>, then I’d type:</p>
<pre><code>ed letter.txt
letter.txt: No such file or directory</code></pre>
<p>Here we see that when <code>ed</code> opens, it’s not very forthcoming or user friendly and if the file <strong>letter.txt</strong> does not already exist, it returns an error message informing of us that. Also, by default we are in command mode. To enter <strong>insert</strong> mode so that I an start writing my letter, I can type an <strong>i</strong> for <strong>insert</strong> or an <strong>a</strong> for <strong>append</strong>:</p>
<pre><code>a
Dear Students,

I hope you find this really interesting and that you feel free to practice and
play on the command line, as well as use tools like ed, the standard editor.

Sincerely,
Dr. Burns
.</code></pre>
<p>After I’ve typed that letter, my goal is to leave <strong>insert</strong> mode and enter <strong>command</strong> mode, which I need to do if I just want to save and exit <code>ed</code>. I do that at the end when I press return to get a new line and typed a period by itself. This is how we tell <code>ed</code> to exit <strong>input</strong> mode and enter <strong>command</strong> mode.</p>
<p>The first line is line 1, but it’s not obvious that this is always so, and it would be hard to know a line number in <code>ed</code> when the file is long. To see line numbers, I can tell <code>ed</code> to show them to me with the following command:</p>
<pre><code>,n</code></pre>
<p>That will display all the line numbers in the file because the comma is shorthand for the entire address space. Or I could tell <code>ed</code> to show me line numbers for a range:</p>
<pre><code>2,3n</code></pre>
<p>And that will print out lines 2 and 3 with line numbers. If I wanted to print those two lines without line numbers, then I switch <strong>n</strong> for <strong>p</strong>:</p>
<pre><code>2,3p</code></pre>
<p>The non-shorthand way to refer to the entire address space, range 1 to the last line, would be to write <code>1,$n</code>, where <strong>1</strong> marks the first line and <strong>$</strong> marks the last line.</p>
<p>There’s a lot more we can do with this text editor because it’s extremely powerful, but for now, let me just show you how to exit. To do so, make sure you’re in <strong>command</strong> mode (press enter to get a new line and then press <strong>.</strong> (or period) to enter <strong>command</strong> mode. If you want to save the file and then quit, then type:</p>
<pre><code>w
q</code></pre>
<p>If you want to quit without saving, then type:</p>
<pre><code>Q</code></pre>
<p>It’s good to know something about <code>ed</code> not just for cultural reasons, but also because the line editing technology developed for it is still in use today, and is a basic part of the <code>vim</code> text editor, which is a very widely used application.</p>
<h2 id="vim"><code>vim</code></h2>
<p>The <code>vim</code> text editor is a take on the <code>vi</code> text editor and is in fact called <strong>Vi IMproved</strong>. Although <code>vim</code> is not a line editor, but a screen-oriented editor, it is multi-modal like <code>ed</code> and in fact is its direct descendant through <a href="https://en.wikipedia.org/wiki/Vi">vi</a>. Due to this genealogy, <code>vim</code> can use many of the same commands as <code>ed</code> does when <code>vim</code> is in command mode. Like <code>ed</code>, we can start <code>vim</code> at the Bash prompt with or without a file name. Here I will open the <strong>letters.txt</strong> file with <code>vim</code>, and will automatically be in <strong>command mode</strong>:</p>
<pre><code>vim letters.txt</code></pre>
<p>To enter <strong>insert mode</strong>, I can type <strong>i</strong> or <strong>a</strong> for <strong>insert</strong> or <strong>append</strong> mode. The difference is that <strong>i</strong> will start <strong>insert</strong> mode where the cursor lies, and <strong>a</strong> will start <strong>insert</strong> mode right-adjacent to the cursor. Once in <strong>insert</strong> mode, you can type text as you normally would and use the arrow keys to navigate around the file.</p>
<p>To get into <strong>command mode</strong> in <code>vim</code>, you can press the <strong>Esc</strong> key. And then you can enter commands like you would with <code>ed</code>, using the same syntax:</p>
<pre><code>[ADDRESS[,ADDRESS]]COMMAND[PARAMETERS]</code></pre>
<p>Unlike <code>ed</code>, when in <strong>command mode</strong>, the commands we type are not wherever the cursor is, but at the bottom of the screen. Let’s first turn on line numbers so we know which address is which, and then we’ll replace <strong>ed</strong> with <strong>Ed</strong>. Note that I precede these commands with a colon:</p>
<pre><code>:set number
:3s/ed/Ed/</code></pre>
<p>One of the more powerful things about both <code>ed</code> and <code>vim</code> is that I can call Bash shell commands from the editors. Let’s say that I wanted to add the date to my letter file. To do that, Linux has a command called <code>date</code> that when typed and executed, will return today’s date. To call the <code>date</code> command within Vim and insert the output into the file, I press <strong>Esc</strong> to enter <strong>command mode</strong> (if I’m not already in it), enter a colon, and then use the shell escape command, which is an exclamation point <code>!</code>, type a space, then <code>r</code> for the read file into buffer command, and then the Bash shell <code>date</code> command:</p>
<pre><code>:! r date</code></pre>
<p>Vim/vi users also love the navigation keystrokes to move around <code>vim</code>, which are the <strong>j,k,l,h</strong> keystrokes:</p>
<ul>
<li><strong>j</strong> moves down line by line</li>
<li><strong>k</strong> moves up line by line</li>
<li><strong>l</strong> moves right letter by letter</li>
<li><strong>h</strong> moves left letter by letter</li>
</ul>
<p>Like the other commands, you can precede this with addresses. To move 2 lines down in <code>vim</code>, you type <code>2j</code>, and so forth. Vi/Vim have had such a powerful impact on software development that you can in fact use these same keystrokes to navigate a number of sites such as Gmail and Facebook.</p>
<p>To save the file and exit <code>vim</code>, we go into <strong>command mode</strong> by pressing the <strong>Esc</strong> key, and then:</p>
<pre><code>:wq</code></pre>
<p>The above only barely scratches the surface and there are whole books on these editors as well as websites, videos, etc that explore them, and especially <code>vim</code> in more detail. But now that you have some familiarity with them, you might find this hilarious: <a href="https://www.gnu.org/fun/jokes/ed-msg.en.html">Ed, man! !man ed</a>.</p>
<h2 id="nano"><code>nano</code></h2>
<p>The <code>nano</code> text editor is the user-friendliest of these text editors but still requires some adjustment as a new command line user. The friendliest thing about <code>nano</code> is that it is modeless, which is what you’re already accustomed to using, because it can be used to enter text and manipulate the text without changing to insert or command mode. It is also friendly because, like many graphical text editors and other graphical software, it uses control keys to perform its operations. The tricky part is that the control keys are assigned to different keystroke combinations than what many graphical editors (or word processors) use. For example, instead of Ctrl-c or Cmd-c to copy, in <code>nano</code> you press the <strong>Alt-6</strong> keys (press <strong>Alt</strong> and <strong>6</strong>). Then to paste, you press <strong>Ctrl-u</strong> instead of the more common <strong>Ctrl-v</strong>. Fortunately, <code>nano</code> lists the shortcuts at the bottom of the screen.</p>
<p>The shortcuts listed need some explanation. The carat mark is shorthand for the keyboard’s <strong>Control (Ctrl)</strong> key. Therefore to Save As a file, we <strong>write</strong> out the file by pressing <strong>Ctrl-o</strong> (<strong>Ctrl-s</strong> works but will not return any prompts). The <strong>Alt</strong> key is also important, and the shorthand for that is <strong>M-</strong>. To mark (highlight) text, you press <strong>Alt-a</strong>, which is listed as <strong>M-A</strong> in the shortcut list at the bottom of the screen, then move the cursor over the text that you want to highlight. If your goal is to copy, then press <strong>Alt-6</strong> to copy the marked (highlighted) text. Move to where you want to paste the text, and press <strong>Ctrl-u</strong> to paste.</p>
<p>For the purposes of this class, that’s all you really need to know about <code>nano</code>. Use it and get comfortable writing in it. Some quick tips:</p>
<ol type="1">
<li><code>nano file.txt</code> will open the file named file.txt</li>
<li><code>nano</code> will open to an empty page</li>
<li>In <code>nano</code>, save a file by pressing <code>Ctrl-o</code> or <code>Ctrl-s</code></li>
<li>Be sure to follow the prompts at the bottom of the screen</li>
<li>Use the arrow keys to navigate around the page/file</li>
</ol>
<h1 id="installing-and-setting-up-our-own-server-installations">Installing and Setting Up Our Own Server Installations</h1>
<h2 id="download-and-install-fedora-and-virtualbox">Download and Install fedora and VirtualBox:</h2>
<ol type="1">
<li>Download fedora Server Edition. We’ll install the x86x64 netinstall ISO image because it’s a smaller download, and then we can install other items once Fedora is running.</li>
</ol>
<ul>
<li><a href="https://getfedora.org/">https://getfedora.org/</a></li>
<li><a href="https://getfedora.org/en/server/download/">https://getfedora.org/en/server/download/</a></li>
</ul>
<ol start="2" type="1">
<li>Download VirtualBox. This will vary depending on whether you run macOS or Windows. If you have issues here, please seek tutorials elsewhere, like YouTube.</li>
</ol>
<ul>
<li>Download VirtualBox: <a href="https://www.virtualbox.org/">https://www.virtualbox.org/</a></li>
</ul>
<h2 id="set-up-in-virtualbox">Set up in VirtualBox:</h2>
<ol type="1">
<li>Click on the <strong>New</strong> button</li>
<li>In the <strong>Name:</strong> field, type in <strong>Fedora-Base-32</strong>. As you type this in, VirtualBox should automatically recognize the <strong>Type:</strong> and <strong>Version</strong>. Click <strong>Next &gt;</strong>.</li>
<li><strong>Memory size</strong>: Depending on your laptop’s memory capabilities, you can set this higher, but it’s really not necessary. The default <strong>1024 MB</strong> should be fine.</li>
<li><strong>Hard disk</strong>: The default is 8.00 GB. Change this to 100 GB on an upcoming screen. For now, make sure you select the default <strong>Create a virtual hard disk now</strong>, and then click on <strong>Create</strong>.</li>
<li><strong>Hard disk file type</strong>: Accept the default, which is <strong>VDI</strong>.</li>
<li><strong>Storage on physical hard disk</strong>: Accept the default, which is <strong>Dynamically allocated</strong></li>
<li><strong>File location and size</strong>: Here you should adjust to 100 GB. Note that you will not use all of this space on your hard drive. It’s the maximum amount that you can use, though. Click on <strong>Create</strong>.</li>
</ol>
<p>The settings box should close. Now highlight the virtual machine in the left pane of the VirtualBox menu, and click on Start.</p>
<h2 id="install-fedora-32-server-edition">Install Fedora 32 Server Edition:</h2>
<ol type="1">
<li>When you start, a window will pop up and ask you to select a virtual optical disk. This is the fedora 32 ISO that you downloaded. We have to select the file icon in the window and then find and select the ISO that we downloaded. Once you do that, click on <strong>Start</strong>.</li>
<li>A terminal will open up. Press <strong>Enter</strong> on the Installing Fedora 32 option. Some setup text will scroll by and soon a graphical installer will launch.</li>
<li>In the graphical installer, you’ll get a message: “WELCOME TO FEDORA 32.” English should be the default options in both panes. Click on <strong>Continue</strong>.</li>
<li>We only have to configure a few things. Click on <strong>Software Selection</strong>. In the right pane, under <strong>Add-Ons for Selected Environment</strong>, select <strong>Headless Management</strong> and <strong>Editors</strong>, and then click on <strong>Done</strong>.</li>
<li>Now we have to partition our hard drive. We could accept automatic partitioning, but we want to fine tune this. So click on <strong>Installation Destination</strong>.</li>
<li>In the next screen, under <strong>Storage Configuration</strong>, select <strong>Custom</strong> and then click <strong>Done</strong>.</li>
<li><strong>Manual Partitioning</strong>: In the next screen, the <strong>LVM</strong> option should already be selected. This stands for <strong>Logical Volume Management</strong>. Make sure that stays selected. Now we have to create some partitions. As we do, note the two pieces of information at the bottom of the screen: the <em>Available Space</em> and the <em>Total Space</em>. The Available Space will change as we add partitions.</li>
<li>Click on the <strong>+</strong> icon, and for <strong>Mount Point</strong>, we’ll start off with the <strong>root partition</strong>, which is indicated with the forward slash: <strong>/</strong> and for <strong>Desired Capacity</strong>, we should input <strong>20 GB</strong>. We’ll proceed with a few other partitions: /boot, swap, /home. We’ll leave about 24 GB of free disk space available for later use. Altogether, our partition map should look like this:</li>
</ol>
<table>
<thead>
<tr class="header">
<th>Mount Point/Partition</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>/home</td>
<td>50 GB</td>
</tr>
<tr class="even">
<td>/tmp</td>
<td>6 GB</td>
</tr>
<tr class="odd">
<td>/</td>
<td>20 GB</td>
</tr>
<tr class="even">
<td>/boot</td>
<td>1 GB</td>
</tr>
<tr class="odd">
<td>swap</td>
<td>4 GB</td>
</tr>
</tbody>
</table>
<p>Note that the <strong>/boot</strong> partition is mapped to <strong>sda1</strong>. This is handy to remember.</p>
<p>Note also that the Available Space listed at the bottom should be about 24.55 GiB.</p>
<p>After you’ve inputted the above info, click on <strong>Done</strong>. Then click on <strong>Accept Changes</strong> in the next window.</p>
<p>Now click on <strong>Begin Installation</strong>.</p>
<ol start="9" type="1">
<li>Set up Root Password and User Creation in the next window. Write down whatever passwords you choose.</li>
<li><strong>Important!</strong> When completing the <strong>Create User</strong> step, make sure you select: <strong>Make this user administrator</strong>. This will add this user to the <strong>wheel</strong> group and thus allow you to use the <code>sudo</code> command; i.e., this user will have administration rights on the server. FYI: on Ubuntu, there is no <strong>wheel</strong> group. Instead, the corresponding administrator group is <strong>adm</strong>.</li>
<li>Wait until installation is complete. When completed, <strong>shutdown</strong> the machine. Do not click on <strong>Reboot</strong>. Instead, click on Machine, and the Power off. Save state.</li>
</ol>
<h2 id="virtualbox-settings">VirtualBox settings</h2>
<ol type="1">
<li>Click on <strong>Settings</strong>. Under the <strong>System</strong> option, deselect <strong>Floppy</strong> and <strong>Optical</strong>. Then click <strong>Okay</strong>.</li>
<li>Now, <strong>Start</strong> your server again. When it starts, you should be able to login with the user account that you created.</li>
</ol>
<h2 id="virtualbox-login">VirtualBox Login</h2>
<p>The first thing we want to do is to update the software on the machine. To do that, we use the <code>dnf</code> command. Login with your user account, and run the following two commands. The upgrade process may take a bit of time, depending on how much needs to be upgraded and your broadband connection:</p>
<pre><code>sudo dnf updateinfo
sudo dnf upgrade</code></pre>
<p>Once the system has been upgraded, let’s power it off. We’re not going to use this system, but clone it and work on the clone. That way if we make a mistake with our cloned installation, we can re-clone from the original. To turn the machine off, type:</p>
<pre><code>sudo poweroff</code></pre>
<p>In the VirtualBox Manager, right click on our installation, and then select <strong>Clone</strong>. Accept the default name or rename it as you prefer. Be sure to choose <strong>Full clone</strong>.</p>
<p>That’s good for now. Congratulations! You have just completed your first installation of a Linux server.</p>
<h1 id="logical-volume-management">Logical Volume Management</h1>
<h2 id="background-reading-and-documentation">Background Reading and Documentation</h2>
<p>These notes follow the steps outlined in book (<a href="https://www.amazon.com/Linux-Administration-Beginners-Guide-Seventh/dp/0071845364">Soyinka</a>), chapter 7, pp. 200-211. Also, some helpful additional reading, with alternate examples, are at:</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-lvm-concepts-terminology-and-operations">An Introduction to LVM Concepts, Terminology, and Operations</a></li>
<li><a href="https://opensource.com/business/16/9/linux-users-guide-lvm">A Linux User’s Guide to Logical Volume Management</a></li>
</ul>
<p>Additionally, you should review some helpful <code>man</code> or <code>info</code> pages:</p>
<ul>
<li><code>man filesytems</code></li>
<li><code>man ext4</code></li>
<li><code>man btrfs</code></li>
<li><code>man vgdisplay</code></li>
<li><code>man pvdisplay</code></li>
<li><code>man lvdisplay</code></li>
<li><code>man pvcreate</code></li>
<li><code>man lvcreate</code></li>
<li><code>man vgextend</code></li>
<li><code>man fdisk</code></li>
<li><code>man lsblk</code></li>
<li><code>man fstab</code></li>
<li><code>man parted</code></li>
<li><code>man mount</code></li>
<li><code>man restorecon</code></li>
</ul>
<p>The second link above demonstrates some other logical volume commands that we are not using here. Give the <code>man</code> or <code>info</code> pages for those a read, too.</p>
<h2 id="our-motivation">Our motivation</h2>
<p>When we installed Fedora in VirtualBox, we told VirtualBox that our hard drive would be a 100 GB in size. However, when we partitioned our hard drive, we only partitioned around 75 GB of that space. In this lesson, we are going to create a new logical volume and assign that to <strong>/var</strong>.</p>
<p>Briefly:</p>
<ul>
<li>Physical volume (the <em>pv</em> commands) are literally about the physical devices.</li>
<li>Volume group (the <em>vg</em> commands) organize the physical and logical volumes.</li>
<li>Logical volumes (the <em>lv</em> commands) are about partitions.</li>
</ul>
<h2 id="procedure">Procedure</h2>
<h3 id="administrative-commands">Administrative commands</h3>
<p>We either need to use the <code>sudo</code> command to run many of the commands below or to login as root. Either way, be careful about running commands with <code>sudo</code> or as root. Mistyping a command may harm your system beyond repair. If you do harm your system beyond repair, delete this clone in VirtualBox and reclone the original install.</p>
<p>If you would like to login as root, you can type the <code>login</code> command and then enter root followed by the root password, or you can use the <code>sudo</code> command if you are in the wheel group:</p>
<pre><code>$ login root</code></pre>
<p>Or:</p>
<pre><code>$ sudo su</code></pre>
<h3 id="gather-information">Gather information</h3>
<p>Take a look at what you have before you start. Pay some attention to the details:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb66-1" title="1"><span class="ex">lsblk</span></a>
<a class="sourceLine" id="cb66-2" title="2"><span class="ex">fdisk</span> -l</a></code></pre></div>
<h3 id="create-a-partition">Create a Partition</h3>
<p>Note: <em>parted</em> is a program that manipulates disk partitions. Go ahead and read the man page on parted before you start.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb67-1" title="1"><span class="co"># parted /dev/sda</span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">print</span></a>
<a class="sourceLine" id="cb67-3" title="3"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mkpart</span></a>
<a class="sourceLine" id="cb67-4" title="4"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">Partion</span> type? primary/extended? primary</a>
<a class="sourceLine" id="cb67-5" title="5"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">File</span> system type? [ext2]? ext4</a>
<a class="sourceLine" id="cb67-6" title="6"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">Start?</span> 81.1GB</a>
<a class="sourceLine" id="cb67-7" title="7"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">End?</span> 100%</a>
<a class="sourceLine" id="cb67-8" title="8"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="kw">set</span> <span class="ex">3</span> lvm on</a>
<a class="sourceLine" id="cb67-9" title="9"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">print</span></a>
<a class="sourceLine" id="cb67-10" title="10"><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">quit</span> </a></code></pre></div>
<h3 id="creating-a-physical-volume">Creating a Physical Volume</h3>
<p>Note: It’s important to read the man pages for <em>pvdisplay</em> and <em>pvcreate</em> before you start so that you get a better idea of what you’re doing, above and beyond what I’m detailing here or the links above describe.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb68-1" title="1"><span class="ex">pvdisplay</span></a>
<a class="sourceLine" id="cb68-2" title="2"><span class="ex">pvcreate</span> /dev/sda3</a>
<a class="sourceLine" id="cb68-3" title="3"><span class="ex">pvdisplay</span></a></code></pre></div>
<h3 id="add-a-physical-volume-to-a-volume-group">Add a Physical Volume to a Volume Group</h3>
<p>Usage note: <code>vgextend VG PV</code>. (See man page, of course :)</p>
<p>Therefore, below, volume group name is <strong>fedora</strong> and physical volume name is, per the last set of commands, <strong>/dev/sda3</strong>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb69-1" title="1"><span class="ex">vgdisplay</span></a>
<a class="sourceLine" id="cb69-2" title="2"><span class="ex">vgextend</span> fedora /dev/sda3</a>
<a class="sourceLine" id="cb69-3" title="3"><span class="ex">vgdisplay</span></a></code></pre></div>
<h3 id="creating-a-logical-volume">Creating a Logical Volume</h3>
<p>Note: man pages!!!</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb70-1" title="1"><span class="ex">lvdisplay</span></a>
<a class="sourceLine" id="cb70-2" title="2"><span class="ex">lvcreate</span> -l 6285 --name var fedora</a>
<a class="sourceLine" id="cb70-3" title="3"><span class="ex">lvdisplay</span> /dev/fedora/var</a></code></pre></div>
<h3 id="creating-a-file-system-for-the-lv">Creating a File System for the LV</h3>
<p><strong>Formatting the disk</strong>: read the man pages, including <code>man fstab</code>. The <em>restorecon</em> command pertains to SELinux. We’ll read about that later in the semester.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb71-1" title="1"><span class="ex">mkfs.btrfs</span> /dev/fedora/var</a>
<a class="sourceLine" id="cb71-2" title="2"><span class="fu">mkdir</span> /new_var</a>
<a class="sourceLine" id="cb71-3" title="3"><span class="fu">mount</span> /dev/fedora/var /new_var/</a>
<a class="sourceLine" id="cb71-4" title="4"><span class="fu">cp</span> -vrp /var/* /new_var/</a>
<a class="sourceLine" id="cb71-5" title="5"><span class="fu">mv</span> /var/ /old_var</a>
<a class="sourceLine" id="cb71-6" title="6"><span class="fu">mkdir</span> /var</a>
<a class="sourceLine" id="cb71-7" title="7"><span class="fu">mount</span> --bind /new_var/ /var/</a>
<a class="sourceLine" id="cb71-8" title="8"><span class="ex">restorecon</span> -R /var</a>
<a class="sourceLine" id="cb71-9" title="9"><span class="fu">nano</span> /etc/fstab</a></code></pre></div>
<p>In <code>nano</code>, enter this:</p>
<pre><code>/dev/mapper/fedora-var    /var   btrfs   defaults  1   2</code></pre>
<p>Now reboot the machine:</p>
<pre><code># reboot</code></pre>
<h1 id="backups-with-rsync">Backups with <code>rsync</code></h1>
<h2 id="create-a-secondary-hard-drive-in-virtualbox">Create a secondary hard drive in VirtualBox</h2>
<p>In VirtualBox, we’ll create a second hard drive (we’re mimicking a scenario where we would physically add a new hard drive to the system).</p>
<p>In VirtualBox:</p>
<ol type="1">
<li>Before starting your virtual machine, go to <strong>Settings</strong> in VirtualBox for your chosen OS.</li>
<li>Click on Storage, and then select: <strong>Controller: SATA</strong>.</li>
<li>Click on the <strong>Blue Floppy Disk +</strong> icon to add a new storage attachment.</li>
<li>Choose <strong>Add Hard Disk</strong> and then <strong>Create New Disk</strong>.</li>
<li>Select default option for <strong>Hard Disk File Type</strong>: <strong>VDI (VirtualBox Disk Image)</strong>.</li>
<li>Choose <strong>Dynamically allocated</strong>.</li>
<li>Name your disk something of your choice. I’ll name mine <strong>Backup</strong>. This name won’t be recognized by the virtual OS. We’ll have to create a name for it when we work with it in the virtual machine/OS.</li>
<li>If you wanted to create a full backup, you might make the disk 100 GB in size to match the 100 GB OS disk, but we’re only going to backup our home directory, so the default 8 GB is fine.</li>
<li>Then choose <strong>Create</strong>.</li>
<li>Close Settings and start your OS as normal.</li>
</ol>
<h2 id="partition-the-new-hard-drive">Partition the new hard drive</h2>
<p>Now that we’ve added a new hard drive, we need to partition it and create a filesystem. We’ll do that in the command line. We’re not going to use LVM, like we did earlier in the semester, but we will revisit the <code>parted</code> and the <code>mkfs</code> utilities:</p>
<pre><code>$ sudo su
lsblk # to identify the new disk
parted /dev/sdb
(parted) print
(parted) mklabel gpt
(parted) mkpart
Partition name? []? backup
File system type? [ext2] ext4
Start? 1
End? 100%
(parted) print
quit
lsblk
mkfs.ext4 /dev/sdb1
mount /dev/sdb1 /mnt
lsblk
cd /mnt</code></pre>
<h2 id="backup-with-rsync">Backup with <code>rsync</code></h2>
<p>Now we’ll use <code>rsync</code> to backup the home directories to the new hard drive. See <code>man rsync</code> for documentation. The basic syntax is:</p>
<pre><code>rsync option source-directory destination-directory</code></pre>
<p>Now I’ll backup the home directories that I’ve created to the new hard drive:</p>
<pre><code>cd /home  # just to check out what I&#39;m backing up
rsync -ahv --delete /home /mnt/</code></pre>
<p><code>rsync</code> will behave differently whether I include or leave out the trailing slash after the <strong>home</strong> source-directory. Thus, the above command and the following will do slightly different things:</p>
<pre><code>rsync -ahv --delete /home/ /mnt/</code></pre>
<p>The first <code>rsync</code> command will back up the home directory and all subdirectories in the <code>/mnt</code> directory:</p>
<pre><code>ls /mnt
home</code></pre>
<p>The second <code>rsync</code> command will back up the home directory in the <code>/mnt/</code> directory.</p>
<pre><code>ls /mnt
sean</code></pre>
<p>The <code>--delete</code> option is important. Without it, <code>rsync</code> will add new files to the destination directory when it backs up the source directory. With it, <code>rsync</code> truly syncs. Thus, if a file that was previously backed up to the destination directory and later deleted in the source directory (e.g., because it was no longer needed), then it will be deleted from the destination directory when the <code>--delete</code> option is used.</p>
<p>See other options and functionality for <code>rsync</code> here: <a href="https://www.linux.com/tutorials/how-backup-files-linux-rsync-command-line/">https://www.linux.com/tutorials/how-backup-files-linux-rsync-command-line/</a>. One of the most important options is the ability to backup up to remote machines over a network.</p>
<h1 id="managing-software">Managing Software</h1>
<p>Many modern Linux distros offer some kind of package management for installing, managing, and removing software. On RedHat based systems, package management is based on RPM (the RedHat Package Manager). On Debian based systems, package management is based on <strong>dpkg</strong>.</p>
<p>There are some advanced things you can do with these base package management systems, but most of the time it will be easier to use their front ends. For RedHat systems, the current front end is called <strong>dnf</strong>, and for Debian systems, it’s <strong>apt</strong> or <strong>apt-get</strong>. Let’s look at a few of the basic <strong>dnf</strong> commands:</p>
<p>To see a history of how <em>dnf</em> has been used on the system:</p>
<p><code>$ sudo dnf history</code></p>
<p>To get info on the history of a specific package:</p>
<p><code>$ sudo dnf history mosh</code></p>
<p>To get information on a specific package:</p>
<p><code>$ sudo dnf info bash</code></p>
<p>To search by tag, which you can see listed in the info search:</p>
<p><code>$ sudo dnf repoquery --queryformat "%{arch}" bash</code></p>
<p><code>$ sudo dnf repoquery --queryformat "%{reponame}" mosh</code></p>
<h2 id="lets-install-something">Let’s install something:</h2>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb80-1" title="1">$ <span class="ex">dnf</span> search tmux</a>
<a class="sourceLine" id="cb80-2" title="2">$ <span class="ex">dnf</span> info tmux</a>
<a class="sourceLine" id="cb80-3" title="3">$ <span class="fu">sudo</span> dnf install tmux</a>
<a class="sourceLine" id="cb80-4" title="4">$ <span class="bu">echo</span> <span class="st">&quot;set-option -g prefix C-a&quot;</span> <span class="op">&gt;</span> .tmux.conf</a>
<a class="sourceLine" id="cb80-5" title="5">$ <span class="ex">tmux</span></a></code></pre></div>
<h2 id="dnf-basics">dnf basics</h2>
<p>Here are the basic <code>dnf</code> commands. See <code>man dnf</code> for details:</p>
<ul>
<li>``dnf search [name]```</li>
<li>``dnf install [name]```</li>
<li>``dnf remove [name]```</li>
<li>``dnf repolist```</li>
<li>``dnf list installed```</li>
<li>``dnf list available```</li>
<li>``dnf provides /bin/bash```</li>
<li>``dnf info [name]```</li>
<li>``dnf update [name]```</li>
<li>``dnf check-update```</li>
<li>``dnf update OR dnf upgrade```</li>
<li>``dnf autoremove```</li>
<li>``dnf clean all```</li>
<li>``dnf help clean```</li>
<li>``dnf help```</li>
<li>``dnf history```</li>
<li>``dnf grouplist | less```</li>
<li>``dnf groupinstall ‘Python Science’```</li>
<li>``dnf groupupdate ‘Python Science’```</li>
<li>``dnf groupremove ‘Python Science’```</li>
</ul>
<h1 id="nat-network-address-translation">NAT (Network Address Translation)</h1>
<h2 id="set-up-nat">Set up NAT</h2>
<p>If we want to SSH into our machines without having to use the VirtualBox GUI, we can do so by setting up NAT in VirtualBox. If we were on a wired connection (not wireless), we could set up a bridged connection, but that’s not simple when we’re connected to a router via wireless. To set up NAT:</p>
<p>Go to Settings, Network, Advanced, Port Forwarding, and enter the following in the table:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: center;">Protocol</th>
<th style="text-align: center;">Host IP</th>
<th style="text-align: center;">Host Port</th>
<th style="text-align: center;">Guest IP</th>
<th style="text-align: right;">Guest Port</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SSH</td>
<td style="text-align: center;">TCP</td>
<td style="text-align: center;">10.163.0.2</td>
<td style="text-align: center;">2222</td>
<td style="text-align: center;">10.0.2.15</td>
<td style="text-align: right;">22</td>
</tr>
</tbody>
</table>
<p>The Host IP should be the IP address for your physical machine. You can find this in your system settings on your Windows or Mac computers, or by opening up a terminal session and typing <code>ifconfig</code> or the equivalent for your operating system. Once you have that IP, start your Fedora clone in headless mode, and SSH into your virtual machine using the terminal of your choice (e.g., the one you used to connect to SISED). From a command line (or via PuTTY settings), we are going to SSH through port 2222 via our Host IP address:</p>
<pre><code>$ ssh -p 2222 user@10.163.0.2</code></pre>
<p>Read about NAT and VirtualBox here: <a href="https://www.virtualbox.org/manual/ch06.html">https://www.virtualbox.org/manual/ch06.html</a></p>
<p>Two <code>VBoxManage</code> commands that you can run from your <strong>Host</strong> machine:</p>
<pre><code>VBoxManage list vms
VBoxManage startvm &quot;Name of VMS&quot; --type headless</code></pre>
<h1 id="systemd">systemd</h1>
<ul>
<li><strong>systemd</strong> is an init system that aims to provide better boot time and a better way to manage services and processes.</li>
<li><strong>systemd</strong> includes additional utilities to help manage services on a Linux system</li>
</ul>
<p>There are only two aspects of <strong>systemd</strong> that I want to cover in this lesson, but know that <strong>systemd</strong> is a big, complicated suite of software that provides a lot of functions. In this lesson, though, we will cover using <strong>systemd</strong> to:</p>
<ol type="1">
<li>manage services</li>
<li>examine logs</li>
</ol>
<h2 id="manage-services">Manage Services</h2>
<p>When we install a complicated piece of software like a web server (e.g., Apache2), a SSH server (e.g., openssh-server), or a database server (e.g., MySQL), then it’s helpful if we have some commands that will help us manager that service (the web service/server, the SSH service/server, etc).</p>
<p>For example, after installing a SSH server, we might like to know if it’s running, or we might want to stop it if it’s running, or start it if it’s not. Let’s see what that looks like. In the following commands, I will use the <code>dnf</code> utility to install the <code>openssh-server</code>. Then I will check the status of the server using the <code>systemctl status</code> command. I will enable it so that it starts automatically when the operating system is rebooted using the <code>systemctl enable</code> command. Finally, I will make sure the firewall allows outside access to the operating system via <code>ssh</code>. I use the <code>sudo</code> command to run the relevant commands as administrator:</p>
<pre><code>dnf search openssh
sudo dnf install openssh-server
systemctl status sshd.service
sudo systemctl enable sshd.service
sudo firewall-cmd --add-service=ssh --permanent</code></pre>
<p>There are similar commands to stop a service or to reload a service if a service configuration file has changed. As an example of the latter, let’s say that I wanted to present a message to anyone who logs into my system remotely using <code>ssh</code>. In order to do that, I need to edit the main <code>ssh</code> configuration file, which is located in <strong>/etc/ssh/sshd_config</strong>:</p>
<pre><code>cd /etc/ssh
sudo nano sshd_config</code></pre>
<p>Then I will remove the beginning pound sign and thus un-comment the following line:</p>
<pre><code>#Banner none</code></pre>
<p>And replace it with a path a file that will contain my message:</p>
<pre><code>Banner /etc/ssh/ssh-banner</code></pre>
<p>After saving and closing <strong>/etc/ssh/sshd_config</strong>, I will create and open the banner file using <code>nano</code>:</p>
<pre><code>sudo nano /etc/ssh/ssh-banner</code></pre>
<p>And add the following:</p>
<pre><code>Unauthorized access to this system is not permitted and will be reported to the authorities.</code></pre>
<p>Since we have changed a configuration for the <code>sshd.service</code>, we need to reload the service so that <code>sshd.service</code> becomes aware of the new configuration. To do that, I use <code>systemctl</code> like so:</p>
<pre><code>sudo systemctl reload sshd.service</code></pre>
<p>Now, when you log into your Fedora system, you will see that new banner displayed.</p>
<h2 id="examine-logs">Examine Logs</h2>
<p>The <code>journalctl</code> command is also part of the <strong>systemd</strong> software suite and is used to monitor logs on the system.</p>
<p>If we just type <code>journalctl</code> at the command prompt, we will be presented with the logs for the entire system. These logs can be paged through by pressing the space bar, the page up/page down keys, or the up/down arrow keys, and they can also be searched by pressing the forward slash <code>/</code>.</p>
<pre><code>journalctl</code></pre>
<p>However, it’s much better to use various options. If you <code>tab tab</code> after typing <code>journalctl</code>, command line completion will provide additional fields (see man page: <code>man 7 systemd.journal-fields</code> and see <code>man man</code> for numbering options) to examine logs for. There are many, but as an example, we see that there is an option called _UID=, which allows us to examine the logs for a user with a specific user id. For example, on our independent Fedora systems, our user ID numbers are 1000. So that means I can see the logs for my account by:</p>
<pre><code>journalctl _UID=1000</code></pre>
<p>The above shows journal entries related to user ID of 1000, which is my user id. We can see other user IDs by concatenating (<code>cat</code>) the <strong>passwd</strong> file. Not only do real humans who have accounts on the system have user IDs, but many services do to. Here I look at journal entries for <code>chronyd</code>, with a user ID of 992. This is a service that manages the system’s time:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb92-1" title="1"><span class="fu">cat</span> /etc/passwd</a>
<a class="sourceLine" id="cb92-2" title="2"><span class="ex">journalctl</span> _UID=984</a></code></pre></div>
<p>I can more specifically look at the logs files for a service by using the <code>-u</code> option with <code>journalctl</code>:</p>
<pre><code>journalctl -u sshd.service</code></pre>
<p>I can examine logs since last boot:</p>
<pre><code>journalctl -b</code></pre>
<p>Or I can follow the logs in real-time (press <strong>ctrl-c</strong> to quit the real-time view):</p>
<pre><code>journalctl -f</code></pre>
<h2 id="useful-systemd-commands">Useful Systemd Commands</h2>
<p>You can see more of what <code>systemctl</code> or <code>journalctl</code> can do by reading through their documentation:</p>
<pre><code>man systemctl
man journalctl</code></pre>
<p>But here are a few other useful commands to explore:</p>
<ul>
<li>list units in memory</li>
</ul>
<pre><code>systemctl list-units</code></pre>
<ul>
<li>list sockets in memory</li>
</ul>
<pre><code>systemctl list-sockets</code></pre>
<ul>
<li>get status, start, stop, reload, restart a unit, e.g., sshd</li>
</ul>
<pre><code>systemctl status sshd.service
systemctl start sshd.service
systemctl stop sshd.service
systemctl reload sshd.service
systemctl restart sshd.service
systemctl reload-or-restart sshd.service</code></pre>
<ul>
<li>enable, disable sshd</li>
</ul>
<pre><code>systemctl enable sshd.service
systemctl disable sshd.service</code></pre>
<ul>
<li>ask systemctl if enabled</li>
</ul>
<pre><code>systemctl is-enabled sshd.service</code></pre>
<ul>
<li>System: reboot, poweroff, or suspend</li>
</ul>
<pre><code>systemctl reboot
systemctl poweroff
systemctl suspend</code></pre>
<ul>
<li>to show changes to the system</li>
</ul>
<pre><code>systemd-delta </code></pre>
<ul>
<li>to list control groups and processes</li>
</ul>
<pre><code>systemd-cgls</code></pre>
<ul>
<li>to list real-time control group process, resource usage, and memory usage</li>
</ul>
<pre><code>systemd-cgtop</code></pre>
<ul>
<li>to search failed processes/services:</li>
</ul>
<pre><code>systemctl --state failed</code></pre>
<ul>
<li>to list services</li>
</ul>
<pre><code>systemctl list-unit-files -t service</code></pre>
<ul>
<li>to examine boot time:</li>
</ul>
<pre><code>systemd-analyze</code></pre>
<h1 id="managing-users-and-groups">Managing Users and Groups</h1>
<h2 id="the-passwd-file">The passwd file</h2>
<p>On my Fedora 32 virtual machine, I can see the following information about my user account in the <strong>passwd</strong> file:</p>
<pre><code>cat /etc/passwd</code></pre>
<p>And I can also <code>grep</code> for specific accounts:</p>
<pre><code>grep &quot;sean&quot; /etc/passwd
sean:x:1000:1000:sean:/home/sean:/bin/bash
grep &quot;sean&quot; /etc/passwd | sed &#39;s/:/\n/g&#39;</code></pre>
<p>The latter command returns the following output, which shows the various fields on each line:</p>
<pre><code>sean
x
1000
1000
sean
/home/sean
/bin/bash</code></pre>
<p>The fields represent the following information:</p>
<ul>
<li>username</li>
<li>password indicator</li>
<li>user id</li>
<li>group id</li>
<li>user name or comment</li>
<li>home directory</li>
<li>default shell</li>
</ul>
<p>Note that you can read about this using <code>man 5 passwd</code>. [ EXPLAIN THE 5 ]</p>
<p>This is a pretty standard Linux file, but some things will change depending on the distribution. For example, the user id may start at a different point depending on the system. However, nowadays both Ubuntu and Fedora set the starting UID and group ID for new users at 1000.</p>
<h2 id="the-shadow-file">The shadow file</h2>
<p>The <strong>/etc/passwd</strong> file does not contain any passwords but a simple <strong>x</strong> to mark the password field. Passwords on Linux are stored in <strong>/etc/shadow</strong> and are hashed with <strong>sha512</strong>, which is indicated by <strong><span class="math inline">6</span></strong>. You need to be root to examine the shadow file or use <code>sudo</code>:</p>
<pre><code>sudo su
grep &quot;sean&quot; /etc/shadow
sean:ENCRYPTED_PASSWORD::0:99999:7:::
grep &quot;sean&quot; /etc/shadow | sed &#39;s/:/\n/g&#39;
sean
ENCRYPTED_PASSWORD

0
99999
7</code></pre>
<p>The fields are (see <code>man 5 passwd</code>):</p>
<ul>
<li>login name (username)</li>
<li>encrypted password</li>
<li>days since 1/1/1970 since password was last changed</li>
<li>days after which password must be changed</li>
<li>minimum password age</li>
<li>maximum password age</li>
<li>password warning period</li>
<li>password inactivity period</li>
<li>account expiration date</li>
<li>a reserved field</li>
</ul>
<h2 id="the-group-file">The group file</h2>
<p>This file holds group information about the entire system (see <code>man group</code>). In the following command, you can see that I’m a member of the <strong>wheel</strong> group (which allow my account to use the <code>sudo</code> command) and that there’s a group name that is also the name of my user account. The <strong>sean</strong> at the end of the <strong>wheel</strong> line indicates that I am a member of the <strong>wheel</strong> group. Although user <strong>sean</strong> is a member of group <strong>sean</strong>, users do not have to be listed as members of their own group.</p>
<pre><code>grep -E &#39;wheel|^sean&#39; /etc/group
wheel:x:10:sean
sean:x:1000:</code></pre>
<p>The fields are:</p>
<ul>
<li>group name</li>
<li>group password</li>
<li>group ID (GID)</li>
<li>group members (user list)</li>
</ul>
<h2 id="management-tools">Management Tools</h2>
<p>Other user and group utilities include:</p>
<ul>
<li><code>/usr/sbin/useradd</code></li>
<li><code>/usr/sbin/usermod</code></li>
<li><code>/usr/sbin/userdel</code></li>
<li><code>/usr/sbin/groupadd</code></li>
<li><code>/usr/sbin/groupdel</code></li>
<li><code>/usr/sbin/groupmod</code></li>
</ul>
<h2 id="practice-1">Practice</h2>
<h3 id="create-a-new-user-modify-account">Create a new user; modify account</h3>
<p>Let’s create a new user and modify the account. First note the defaults in <strong>/etc/login.defs</strong>, <strong>/etc/skel</strong>, and <strong>/etc/default/useradd</strong>. And then let’s change some defaults. We can either user <code>sudo</code> or become <code>su</code>. Here I both to become root:</p>
<pre><code>sudo su
nano /etc/skel/.bashrc</code></pre>
<p>Now we’re in <code>nano</code>, and we want to add these lines at the end. Feel free to add the comments:</p>
<pre><code># make &quot;c&quot; a shortcut for &quot;clear&quot;
alias c=&#39;clear&#39;</code></pre>
<p>Now use <code>nano</code> again to create a README file. This file will be added to the home directories of all new users. Add any welcome message you want to add, plus any guidelines for using the system.</p>
<pre><code>nano /etc/skel/README</code></pre>
<p>After writing (saving) and exiting <code>nano</code>, we can go ahead and create the new user:</p>
<pre><code>useradd linus
grep &quot;linus&quot; /etc/passwd
linus:x:1002:1003::/home/linus:/bin/bash
grep &quot;linus&quot; /etc/shadow
linus:!!:18186:0:99999:7:::</code></pre>
<p>Let’s create a password for <em>linus</em>:</p>
<pre><code>passwd linus
grep &quot;linus&quot; /etc/shadow</code></pre>
<p>Let’s modify the minimum days and maximum days of the password’s lifetime:</p>
<pre><code>passwd -n 90 linus
passwd -x 180 linus</code></pre>
<h3 id="create-a-new-group-add-users-to-the-group">Create a new group; add users to the group</h3>
<p>Let’s now create a new group; add users to group:</p>
<pre><code>grep &quot;linus&quot; /etc/group
linus:x:1001:
groupadd project1
grep &quot;project1&quot; /etc/group
project1:x:1002:
usermod -aG project2 linus
usermod -aG project2 sean
grep &quot;project1&quot; /etc/group
project1:x:1002:linus,sean</code></pre>
<p>Exit out of root if logged in as root.</p>
<p>Now login as user linus:</p>
<pre><code>su linus
Password:
groups
linus project1</code></pre>
<p>Create a shared directory with user sean (or yourself on your machines)</p>
<pre><code>cd /srv
mkdir ourproject
ls -ld ourproject
drwx------. 2 linus linus 6 Oct 17 08:52 ourproject/
chmod 2770 ourproject
ls -ld ourproject
drwxrwx---. 2 linus linus 6 Oct 17 08:52 ourproject/
chown linus:project1 ourproject/
ls -ld ourproject
drwxrwx---. 2 linus project1 6 Oct 17 08:52 ourproject/
exit</code></pre>
<p>Login as normal user (that’s sean for me)</p>
<pre><code>exit</code></pre>
<p>And then relogin so that the group mod will take effect</p>
<pre><code>groups
sean wheel project1</code></pre>
<p>Now let’s delete the new user’s account:</p>
<h3 id="user-account-and-group-deletion">User account and group deletion</h3>
<pre><code>userdel -r linus
grep &quot;linus&quot; /etc/passwd
grep &quot;linus&quot; /etc/shadow
cd /home ; ls -l </code></pre>
<p>Group deletion:</p>
<pre><code>grep &quot;project*&quot; /etc/group
groupdel project1
grep &quot;project*&quot; /etc/group</code></pre>
<h3 id="another-group-example">Another Group Example</h3>
<p>Basic steps to:</p>
<ol type="1">
<li>create a new user</li>
<li>create a new group</li>
<li>create a shared directory for the new group</li>
</ol>
<pre><code># become root user
sudo su      

# create user account
useradd bfox

# create password for user bfox
passwd bfox

# create new group
groupadd bashclub

# add user sean to &#39;bashclub&#39; group
usermod -aG bashclub sean

# add user bfox to &#39;bashclub&#39; group
usermod -aG bashclub bfox

# check if sean is part of &#39;bashclub&#39; group
groups sean

# check if bfox is part of &#39;bashclub&#39; group
groups bfox

# change to /home directory
cd /home

# create the directory to be shared by bashclub 
mkdir bashclubfolder

# make bashclub group owner of bashclubfolder
chgrp -R bashclub bashclubfolder
chmod -R 2775 bashclubfolder

# check ownership
ls -l </code></pre>
<p>Now you can log in as either user and work in that shared directory!</p>
<h1 id="networking">Networking</h1>
<h2 id="link-layer">Link Layer</h2>
<h3 id="arp-address-resolution-protocol">ARP (Address Resolution Protocol)</h3>
<p><em>ARP</em> or Address Resolution Protocol is a protocol used to map a network address like the IP address to the ethernet address (MAC, Media Access Control address or hardware address). Routers use MAC addresses to enable communication inside networks (w/in subnets) so that computers within a local area network talk to each other. But also, networks are designed so that IP addresses must be associated with MAC addresses before systems can communicate over a network.</p>
<p>In order to get ARP info for a system, we can use the <code>ip</code> command. Here’s the ARP output and routing table on my Fedora virtual machine (<strong>10.0.2.15</strong>) running on my desktop via a bridged connection:</p>
<pre><code>$ ip neigh show
10.0.2.2 dev enp0s3 lladdr 52:54:00:12:35:02 REACHABLE
10.0.2.3 dev enp0s3 lladdr 52:54:00:12:35:03 STALE
$ ip route show
default via 10.0.2.2 dev enp0s3 proto dhcp metric 100 
10.0.2.0/24 dev enp0s3 proto kernel scope link src 10.0.2.15 metric 100</code></pre>
<p>Where:</p>
<ul>
<li><strong>10.0.2.15</strong> is the IP address of my fedora server <strong>10.0.2.2</strong> is the first</li>
<li>usable address on subnet, and is likely the router; likewise, <strong>52…02</strong> is the hardware address for that virtual router</li>
<li><strong>10.0.2.0</strong> is called the <strong>network address</strong>, which is a unique identifier IP address for the subnet</li>
</ul>
<p>In short, for network traffic to get to the internet, the Fedora machine must know where the router (another computer) is located on the network and must know what the router’s hardware (MAC) address.</p>
<h2 id="internet-layer">Internet Layer</h2>
<h3 id="ip-internet-protocol">IP (Internet Protocol)</h3>
<p><em>IP</em> is a way to uniquely identify a host on a network. If that network is subnetted (i.e., routed), then a host’s IP address will have a subnet or private IP address that will not be directly exposed to the Internet.</p>
<p>There are IP address ranges that are private by default and by design. The default subnet or private addresses ranges include:</p>
<table>
<thead>
<tr class="header">
<th>Start Address</th>
<th>End Address</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10.0.0.0</td>
<td>10.255.255.255</td>
</tr>
<tr class="even">
<td>172.16.0.0</td>
<td>172.31.255.255</td>
</tr>
<tr class="odd">
<td>192.168.0.0</td>
<td>192.168.255.255</td>
</tr>
</tbody>
</table>
<p>If you have a router at home, and look at the IP address for your phone or computer that’s connected to that router, then it will have an address within one of the ranges above, and perhaps it will have an IP address beginning with <strong>192.168.X.X</strong>. This a standard IP address range for a home router. The <strong>10.X.X.X</strong> private range can, by design, assign many more IP addresses, which is why you’ll see that IP range on bigger networks, like UK’s.</p>
<p>At work, my IP address on my desktop was <strong>10.163.34.59/24</strong> (<code>ip a</code>), via a wired connection (eno1) and my office neighbor’s IP address was <strong>10.163.34.65/24</strong>. This shows that we’re both on the same subnet, but if we both, using our respective wired connected computers, Google ‘what’s my IP address’, then we both get back a public IP address of <strong>128.163.8.25</strong>. This is the same for the virtual machine I’m using that’s running Fedora 30, connected via a bridge network.</p>
<p>Thus, w/o any additional information, we know that all traffic coming from our computers and going out to the Internet looks like it’s coming from the same IP address (<strong>128.163.8.25</strong>). And in reverse, all traffic coming from outside our network first goes to <strong>128.163.8.25</strong> before it’s routed to our respective computers.</p>
<p>On the other hand, my laptop, just a few feet away from me, was, when I originally wrote this, connected to UK wireless (eduroam), and not wired, and had this IP address: <strong>10.47.34.150/16</strong> (wlp3s0). You can see there’s a different pattern with this IP address. The reason it has a different pattern is because this laptop is on an different subnet and it’s one that allows more hosts to connect to it, which makes sense, since we can’t necessarily predict how many wireless devices will need to connect via it. In the meantime, if I use a browser on this laptop and ask Google for my IP address, it tells me: <strong>128.163.238.148</strong>, which shares the same IP pattern as the one above.</p>
<h3 id="routing">Routing</h3>
<p>On my virtual machine on my desktop (NAT connection), I can see the network information for my machine (some output removed / truncated for clarity) with the <code>ip</code> command:</p>
<pre><code>$ ip a
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:e1:b5:c8 brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute enp0s3
       valid_lft 690726sec preferred_lft 690726sec
    inet6 fe80::22da:ba7f:d634:2493/64 scope link dadfailed tentative noprefixroute 
       valid_lft forever preferred_lft forever
    inet6 fe80::f084:e92e:908e:2d0c/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever</code></pre>
<p>In the meantime, here’s the routing table on my Fedora VM via a bridged connection (not NAT):</p>
<pre><code>$ ip route
default via 10.163.34.1 dev enp0s3 proto dhcp metric 100 
10.163.34.0/24 dev enp0s3 proto kernel scope link src 10.163.34.118 metric 100</code></pre>
<p>And then on my physical machine:</p>
<pre><code>$ ip route
default via 10.163.34.1 dev eno1 proto dhcp metric 100 
10.163.34.0/24 dev eno1 proto kernel scope link src 10.163.34.59 metric 100 
169.254.0.0/16 dev eno1 scope link metric 1000 
192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1 linkdown</code></pre>
<p>Since both machines are on the same network, they both state the following path:</p>
<ol type="1">
<li>all packets originating at <strong>10.163.34.118</strong> (for Fedora VM) or <strong>10.163.34.59</strong> (for physical machine) are routed through <strong>10.163.34.1</strong> on the subnet defined as <strong>10.163.34.0/24</strong>.</li>
<li>In the second <code>ip route</code> output, you’ll notice the IP address <strong>169.254.0.0/16</strong>. This is called the <a href="https://tools.ietf.org/html/rfc3927.html">link-local</a> address. This is a local address that is assigned to a device in the absence of either static or dynamic IP assignment (via, e.g., a router).</li>
<li>The <strong>192.168.122.0/24</strong> info is from VirtualBox.</li>
</ol>
<p>Here’s kind of visual diagram of what this network looks like:</p>
<figure>
<img src="network.png" alt="network diagram" /><figcaption>network diagram</figcaption>
</figure>
<h3 id="using-the-ip-command">Using the <code>ip</code> command</h3>
<p>The <code>ip</code> command can do more than simply provide us information about our network. We can also use it to turn a connection to the network on or off (and more). Here’s how to disable and then enable a connection on a machine. Note that <strong>enp0s3</strong> is the name of my network card/device. You’d have to replace it with the name of yours. If it’s a wireless card, it might begin with a ‘w’:</p>
<pre><code>sudo ip link set enp0s3 down
sudo ip link set enp0s3 up</code></pre>
<h3 id="ipv6-subnetting">IPv6 subnetting</h3>
<p>We’re not going to get into subnetting with IPv6, but if you’re interested, this is a nice article: <a href="https://supportforums.cisco.com/document/66991/ipv6-subnetting-overview-and-case-study">IPv6 subnetting overview</a></p>
<h3 id="icmp">ICMP</h3>
<p><em>ICMP</em> or Internet Control Message Protocol is a protocol used to send error messages, e.g., to check if a host is down. When we use <em>ping</em>, we’re using the ICMP protocol. Data is not usually sent over this protocol.</p>
<pre><code>ping google.com</code></pre>
<h2 id="transport-layer">Transport Layer</h2>
<p><em>TCP</em> or Transmission Control Protocol is responsible for the transmission of data and for making sure the data arrives at its destination w/o errors.</p>
<p><em>UDP</em> or User Datagram Protocol performs a similar function as TCP, but it doesn’t error check. If data is lost, then it’s lost but is still sent. UDP is useful for conducting voice over internet calls or for streaming video, such as through YouTube. In fact, YouTube uses a type of UDP transmission called QUIC, which adds a level of encryption to the protocol. QUIC was developed by Google and is the main part of the next generation of <a href="https://en.wikipedia.org/wiki/HTTP/3">HTTP/3</a>. In the near future, it seems that we’ll all be using IP/UDP instead of IP/TCP as the primary method of exchanging data over the Internet.</p>
<p>The above protocols, as well as others, each contain <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">header</a> information. We can see a lot of this information using the <code>tcpdump</code> command, which requires <code>sudo</code> or being <strong>root</strong> to use. The first part of the IP header contains the source address, then comes the destination address, and so forth. Aside from a few other parts, this is the primary information in an IP header.</p>
<pre><code>sudo tcpdump host IP-NUMBER</code></pre>
<p>TCP and UDP headers will contain a bit more information, including port information for both source and destination, sequence (SYN) information for data packets, acknowledgment (ACK) information for the ACK number, as well as data and error checking if it’s TCP.</p>
<p>A <em>port</em> associates a process with a network service. Ports provide a way to distinguish and filter all traffic through an IP address. E.g., all traffic going to IP address X.X.X.X:80 indicates that this is http traffic for the http web service. Note that the port info is attached to the end of the IP address via a colon. Other common ports include:</p>
<ul>
<li>21: FTP</li>
<li>22: SSH</li>
<li>25: SMTP</li>
<li>53: DNS</li>
<li>143: IMAP</li>
<li>443: HTTPS</li>
<li>587: SMTP Secure</li>
<li>993: IMAP Secure</li>
</ul>
<p>There’s a complete list of the 1000s of hard coded ports on your Linux systems and it’s located in the following file:</p>
<pre><code>less /etc/services</code></pre>
<p>See also the Wikipedia page: <a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers">List of TCP and UDP port numbers</a></p>
<h1 id="some-basic-ip-subnetting">Some basic IP subnetting</h1>
<h2 id="private-ip-ranges">Private IP Ranges</h2>
<p>Remember, when subnetting, we primarily will work with private IP ranges:</p>
<table>
<thead>
<tr class="header">
<th>Start Address</th>
<th>End Address</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10.0.0.0</td>
<td>10.255.255.255</td>
</tr>
<tr class="even">
<td>172.16.0.0</td>
<td>172.31.255.255</td>
</tr>
<tr class="odd">
<td>192.168.0.0</td>
<td>192.168.255.255</td>
</tr>
</tbody>
</table>
<h2 id="ip-meaning">IP Meaning</h2>
<p>An IP address is 32 bits (8 x 4), or four bytes, in size. In human readable context, it’s usually expressed in the following notation style:</p>
<ul>
<li><strong>192.168.1.6</strong></li>
<li><strong>172.16.3.44</strong></li>
</ul>
<p>Each set of numbers separated by a dot is referred to as an <strong>octet</strong>, and an <strong>octet</strong> is a group of 8 <strong>bits</strong>. Eight <strong>bits</strong> also equal a single <strong>byte</strong>.</p>
<table>
<thead>
<tr class="header">
<th>Term</th>
<th>Symbol</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bit</td>
<td><em>b</em></td>
</tr>
<tr class="even">
<td>byte</td>
<td>B</td>
</tr>
<tr class="odd">
<td>octet</td>
<td><em>o</em></td>
</tr>
</tbody>
</table>
<p>Each bit is represented by either a 1 or a 0. For example, the first address above in binary is:</p>
<ul>
<li>11000000.10101000.00000001.00000110</li>
<li>192.168.1.6</li>
</ul>
<p>Or:</p>
<ul>
<li>11000000 = 192</li>
<li>10101000 = 168</li>
<li>00000001 = 1</li>
<li>00000110 = 6</li>
</ul>
<h2 id="ip-math">IP Math</h2>
<p>When doing IP math, one easy way to do it is to simply remember that each bit in each of the above bytes is a placeholder for the following values:</p>
<p><strong>128 64 32 16 8 4 2 1</strong></p>
<p>Alternatively, from low to high:</p>
<table>
<thead>
<tr class="header">
<th>base-2</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2^0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2^1</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2^2</td>
<td>4</td>
</tr>
<tr class="even">
<td>2^3</td>
<td>8</td>
</tr>
<tr class="odd">
<td>2^4</td>
<td>16</td>
</tr>
<tr class="even">
<td>2^5</td>
<td>32</td>
</tr>
<tr class="odd">
<td>2^6</td>
<td>64</td>
</tr>
<tr class="even">
<td>2^7</td>
<td>128</td>
</tr>
</tbody>
</table>
<p>In binary, 192 is equal to 11000000. It’s helpful to work backward. For IP addresses, all octets are 255 or less (256 total, from 0 to 255) and therefore do not exceed 8 bits or places:</p>
<pre><code>1 * 2^7 = 128
1 * 2^6 =  64 (128 + 64 = 192)</code></pre>
<p>STOP: There are no values left, and so the rest are zeroes.</p>
<p>So: 11000000</p>
<p>Our everyday counting system is base-10, but binary is base-2, and so another way to convert binary to decimal is to multiple each bit by the power of base two and to the power of its placeholder:</p>
<pre><code>(0 * 2^0) = 0 +
(0 * 2^1) = 0 +
(0 * 2^2) = 0 +
(0 * 2^3) = 0 +
(0 * 2^4) = 0 +
(0 * 2^5) = 0 +
(1 * 2^6) = 64 +
(1 * 2^7) = 128 = 192</code></pre>
<p>Another way: to convert to binary, simply subtract the numbers from each value. As long as there is something remaining or the placeholder equals the remainder of the previous subtraction, then the bit equals 1. So:</p>
<ul>
<li>192 - 128 = 64 – therefore the first bit is equal to 1.</li>
<li>Now take the leftover and subtract it:</li>
<li>64 - 64 = 0 – therefore the second bit is equal to 1.</li>
</ul>
<p>Since there is nothing remaining, the rest of the bits equal 0.</p>
<p><strong>NOTE</strong>: show more examples</p>
<h2 id="subnetting">Subnetting</h2>
<p>Subnetting involves dividing a network into two or more subnets. When we subnet, we need to first identify the number of hosts we will require on the subnet. For starters, let’s assume that we need a subnet that can assign at most 254 IP addresses to the devices attached to it via the router.</p>
<p>We also need two additional IP addresses: the <strong>subnet mask</strong> and the <strong>network address/ID</strong>. The <strong>network address</strong> identifies the network and the <strong>subnet mask</strong> marks the boundary between the network and the hosts. Knowing or determining the <strong>subnet mask</strong> will allow us to determine how many hosts can exist on a network. Both the <strong>network address</strong> and the <strong>subnet mask</strong> can be written as IP addresses, but they cannot be assigned to computers on a network.</p>
<p>Finally, when we have these IPs, we will also know the <strong>broadcast address</strong>. This is the last IP address in a subnet range, and it cannot be assigned to a connected device. The <strong>broadcast address</strong> is used by a router, for instance, to communicate to all connected devices, and is comparable to the MAC address that we learned about in our discussion on the link layer and ARP.</p>
<p>For our sake, let’s work backwards, though, and say we want to identify and describe a network that we are connected to. Let’s work with two example private IP addresses that exist on two separate subnets:</p>
<p><strong>IP addresses:</strong></p>
<ul>
<li>192.168.1.6/24: Some Desktop 1, Subnet A</li>
<li>10.160.38.75/24: Some Desktop 1, Subnet B</li>
</ul>
<h3 id="example-1-192.168.1.6-desktop-1-subnet-a">Example 1: 192.168.1.6 : Desktop 1, Subnet A</h3>
<p>Let’s derive the network mask and the network address (or ID) from this IP address.</p>
<pre><code>11000000.10101000.00000001.00000110 IP              192.168.1.6
11111111.11111111.11111111.00000000 Mask            255.255.255.0
-----------------------------------
11000000.10101000.00000001.00000000 Network Address 192.168.1.0</code></pre>
<p>Note the mask has 24 ones followed by 8 zeroes. That 24 is used as CIDR notation, so:</p>
<p>192.168.1.6/24</p>
<h3 id="example-2-10.160.38.75-desktop-1-subnet-b">Example 2: 10.160.38.75 : Desktop 1, Subnet B</h3>
<pre><code>00001010.10100000.00100110.01001011 IP               10.160.38.75
11111111.11111111.11111111.00000000 Mask            255.255.255.0
-----------------------------------
00001010.10100000.00100110.00000000 Network Address   10.163.38.0</code></pre>
<p>For Desktop 1, Subnet A, we have the following:</p>
<table>
<thead>
<tr class="header">
<th>Type</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Netmask/Mask</td>
<td>255.255.255.0</td>
</tr>
<tr class="even">
<td>Network ID</td>
<td>192.168.1.0</td>
</tr>
<tr class="odd">
<td>Start Range</td>
<td>192.168.1.1</td>
</tr>
<tr class="even">
<td>End Range</td>
<td>192.168.1.254</td>
</tr>
<tr class="odd">
<td>Broadcast</td>
<td>192.168.1.255</td>
</tr>
</tbody>
</table>
<p>For Desktop 1, Subnet B, we have the following</p>
<table>
<thead>
<tr class="header">
<th>Type</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Netmask/Mask</td>
<td>255.255.255.0</td>
</tr>
<tr class="even">
<td>Network ID</td>
<td>10.163.38.0</td>
</tr>
<tr class="odd">
<td>Start Range</td>
<td>10.163.38.1</td>
</tr>
<tr class="even">
<td>End Range</td>
<td>10.163.38.254</td>
</tr>
<tr class="odd">
<td>Broadcast</td>
<td>10.163.38.255</td>
</tr>
</tbody>
</table>
<h3 id="example-3-172.16.1.6224">Example 3: 172.16.1.62/24</h3>
<p>Derive the network information for 172.16.1.62/24:</p>
<pre><code>10101100 00010000 00000001 00100111 IP                172.16.1.62
11111111 11111111 11111111 00000000 Mask            255.255.255.0
-----------------------------------
10101100 00010000 00000001 00000000 Network Address    172.16.1.0</code></pre>
<table>
<thead>
<tr class="header">
<th>Type</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Netmask/Mask</td>
<td>255.255.255.0</td>
</tr>
<tr class="even">
<td>Network ID</td>
<td>172.16.1.0</td>
</tr>
<tr class="odd">
<td>Start Range</td>
<td>172.16.1.1</td>
</tr>
<tr class="even">
<td>End Range</td>
<td>172.16.1.254</td>
</tr>
<tr class="odd">
<td>Broadcast</td>
<td>172.16.1.255</td>
</tr>
</tbody>
</table>
<h3 id="example-4-10.0.5.2316">Example 4: 10.0.5.23/16</h3>
<p>This is an example of a subnet with more possible hosts.</p>
<table>
<thead>
<tr class="header">
<th>base-2</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2^0</td>
<td>1</td>
</tr>
<tr class="even">
<td>2^1</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2^2</td>
<td>4</td>
</tr>
<tr class="even">
<td>2^3</td>
<td>8</td>
</tr>
<tr class="odd">
<td>2^4</td>
<td>16</td>
</tr>
<tr class="even">
<td>2^5</td>
<td>32</td>
</tr>
<tr class="odd">
<td>2^6</td>
<td>64</td>
</tr>
<tr class="even">
<td>2^7</td>
<td>128</td>
</tr>
</tbody>
</table>
<pre><code>10.0.5.23/16

00001010.00000000.00000101.00010111 IP Address: 10.0.5.23
11111111.11111111.00000000.00000000 Mask:       255.255.0.0
-----------------------------------------------------------
00001010.00000000.00000000.00000000 Network ID: 10.0.0.0</code></pre>
<table>
<thead>
<tr class="header">
<th>Type</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>IP Address</td>
<td>10.0.5.23</td>
</tr>
<tr class="even">
<td>Netmask/Mask</td>
<td>255.255.0.0</td>
</tr>
<tr class="odd">
<td>Network ID</td>
<td>10.0.0.0</td>
</tr>
<tr class="even">
<td>Start Range</td>
<td>10.0.0.1</td>
</tr>
<tr class="odd">
<td>End Range</td>
<td>10.0.255.254</td>
</tr>
<tr class="even">
<td>Broadcast</td>
<td>10.0.255.255</td>
</tr>
</tbody>
</table>
<p>Hosts:</p>
<table>
<thead>
<tr class="header">
<th>IPs</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10.0.0.1</td>
<td></td>
</tr>
<tr class="even">
<td>10.0.0.255</td>
<td>= 256</td>
</tr>
<tr class="odd">
<td>10.0.1.1</td>
<td></td>
</tr>
<tr class="even">
<td>10.0.255.255</td>
<td>= 256</td>
</tr>
</tbody>
</table>
<ul>
<li>Number of Hosts = 256 x 256 = 65536</li>
<li>Subtract Network ID (1) and Broadcast (1) = 2 IP addresses</li>
<li>Number of Usable Hosts = 256 x 256 - 2 = 65534</li>
</ul>
<h1 id="introduction-to-dns-the-domain-name-system">Introduction to DNS, the Domain Name System</h1>
<h2 id="dns-intro-videos">DNS Intro Videos</h2>
<p>Two helpful YouTube videos. The first one provides an overview of the DNS system:</p>
<p><a href="https://www.youtube.com/watch?v=mpQZVYPuDGU)">How a DNS Server (Domain Name System) works</a></p>
<p>The second video illustrates how to use a GUI to create and manage DNS records.</p>
<p><a href="https://www.youtube.com/watch?v=cwT82ibOM2Q">DNS Records</a></p>
<p>Here is a nice intro to recursive DNS:</p>
<p><a href="https://www.cloudflare.com/learning/dns/what-is-recursive-dns/">https://www.cloudflare.com/learning/dns/what-is-recursive-dns/</a></p>
<h2 id="fqdn-the-fully-qualified-domain-name">FQDN: The Fully Qualified Domain Name</h2>
<p>The structure of the domain name system is like the structure of the UNIX/Linux file hierarchy. It’s like an inverted tree.</p>
<p>The fully qualified domain name includes a period at the end of the top-level domain. Your browser is able to supply that dot since we often don’t use it when typing website addresses.</p>
<p>Thus, for Google’s main page, the FQDN is:</p>
<p>FQDN: www.google.com.</p>
<p>And the parts include:</p>
<pre><code>.           root domain
com         top-level domain
google.     second-level domain
www.        third-level domain</code></pre>
<p>This is important to know so that you understand how the <strong>Domain Name System</strong> works and which DNS servers are responsible for their part of the network.</p>
<h2 id="root-domain">Root domain</h2>
<p>The root domain is managed by root name servers. These servers are managed by ICANN, the Internet Corporation for Assigned Names and Numbers. The root servers manage the root domain, alternatively referred to as the zone.</p>
<h3 id="alternative-dns-root-systems">Alternative DNS root systems</h3>
<p>It’s possible to have alternate internets by using outside root name servers. This is not common, but it happens. Read about a few of them here:</p>
<ul>
<li>sdf: <a href="https://web.archive.org/web/20081121061730/http://www.smtpnic.org/">https://web.archive.org/web/20081121061730/http://www.smtpnic.org/</a></li>
<li>opennic: <a href="https://www.opennicproject.org/">https://www.opennicproject.org/</a></li>
<li>alternic: <a href="https://en.wikipedia.org/wiki/AlterNIC">https://en.wikipedia.org/wiki/AlterNIC</a></li>
</ul>
<p>Russia might be planning to use it’s own alternate internet based on a different DNS root system. This would essentially create a large, second internet. You can read about in this <a href="https://spectrum.ieee.org/tech-talk/telecom/internet/could-russia-really-build-its-own-alternate-internet">IEEE Spectrum article</a>.</p>
<h2 id="top-level-domain-tld">Top level domain (TLD)</h2>
<p>Some examples of top level domains that we are familiar with include:</p>
<ul>
<li>examples include: .org, .com, .net, .mil, .gov</li>
<li>country code: .us, .uk, .ca</li>
</ul>
<p>We can download a list of those top level names from ICANN and count how many there are now:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb143-1" title="1">$ <span class="fu">wget</span> http://data.iana.org/TLD/tlds-alpha-by-domain.txt</a>
<a class="sourceLine" id="cb143-2" title="2">$ <span class="fu">wc</span> -l tlds-alpha-by-domain.txt</a>
<a class="sourceLine" id="cb143-3" title="3"><span class="ex">1528</span> tlds-alpha-by-domain.txt</a></code></pre></div>
<p>The first line in that file is a title, which means there are 1527 top level domains currently in existence.</p>
<h2 id="second-level-domain-names">Second-level domain names</h2>
<p>In the Google example, the second level domain is <strong>google</strong>. Other examples include: <strong>redhat</strong> in <strong>redhat.com</strong> and <strong>debian</strong> in <strong>debian.org</strong>. <a href="https://www.amazon.com/Linux-Administration-Beginners-Guide-Seventh/dp/0071845364">Soyinka, (2016)</a> refers to this part of the FQDN as that which makes up the “organizational boundary of the namespace” (p. 425).</p>
<h2 id="third-level-domain-names-hostnames-subdomains">Third-level domain names / hostnames / subdomains</h2>
<p>When you’ve purchased (leased) a top and second level domain like getfedora.org, you, as an admin, can choose whether you employ third level domains. For example: www is a third level domain. If you owned <code>example.org</code>, you could also have <code>www.example.org</code> resolve to a different location, or, <code>www.example.org</code> could resolve to the second-level domain itself. That is:</p>
<ul>
<li>www.debian.org points to debian.org</li>
</ul>
<p>But it could also point to a separate server, such that <strong>debian.org</strong> and <strong>www.debian.org</strong> would be two separate servers with two separate websites or services. Although this is not common with third-level domains that start with <strong>www</strong>, it is common with others.</p>
<p>For example, with hostnames that are not <code>www</code>:</p>
<ul>
<li>although google.com resolves to www.google.com</li>
<li>google.com does not resolve to drive.google.com or maps.google.com or mail.google.com because those other three provide different, but specific services</li>
</ul>
<h2 id="recursive-and-forward-dns-servers">Recursive and Forward DNS Servers</h2>
<p>Recursive DNS is the first DNS server to be queried in the DNS system. This is the resolver server in the first video above. This server queries itself (recursive) to check if the domain to IP mapping has been cached in its system.</p>
<p>If it hasn’t been cached, then the DNS query is <em>forwarded</em> to a root server and and so forth down the line.</p>
<h2 id="dns-servers">DNS servers</h2>
<p>Root name servers contain the root zone file and point to the primary DNS servers. You can read the root files here:</p>
<p><a href="https://www.iana.org/domains/root/files">https://www.iana.org/domains/root/files</a></p>
<h2 id="dns-record-types">DNS Record types</h2>
<ul>
<li>SOA: Start of Authority: describes the site’s DNS entries
<ul>
<li>IN: Internet Record</li>
</ul></li>
<li>NS: Name Server: state which name server provides DNS resolution</li>
<li>A: Address records: provides mapping hostname to IPv4 address</li>
<li>AAAA: Address records: provides mapping hostname to IPv6 address</li>
</ul>
<pre><code>dig google.com
google.com.     IN      A       216.58.192.142</code></pre>
<ul>
<li>PTR: Pointer Record: provides mapping form IP Address to Hostname</li>
<li>MX: Mail exchanger: the MX record maps your email server.</li>
<li>CNAME: Canonical name: used so that a domain name may act as an alias for another domain name. Thus, say someone visits www.example.org, but if no subdomain is set up for www, then the CNAME can point to example.org.</li>
</ul>
<h2 id="dns-toolbox">DNS Toolbox</h2>
<p>It’s important to be able to troubleshoot DNS issues. To do that, we have a few utilities available. Here are examples and you should read the <code>man</code> pages for each one:</p>
<p><code>host</code>: resolve hostnames to IP Address; or IP addresses to hostnames</p>
<pre><code>man -f host
host (1) - DNS lookup utility
host uky.edu
host 128.163.35.46
host -t MX uky.edu
host -t MX dropbox.com
host -t MX netflix.com
host -t MX wikipedia.org</code></pre>
<p><code>dig</code>: domain information gopher – get info on DNS servers</p>
<pre><code>man -f dig
dig (1) - DNS lookup utility
dig uky.edu
dig uky.edu MX
dig www.uky.edu CNAME</code></pre>
<p><code>nslookup</code>: query internet name servers</p>
<pre><code>man -f nslookup
nslookup (1) - query Internet name servers interactively
nslookup 
&gt; uky.edu
&gt; yahoo.com
&gt; exit</code></pre>
<p><code>whois</code>: determine ownership of a domain</p>
<pre><code>man -f whois
whois (1) - client for the whois directory services
whois uky.edu | less</code></pre>
<p><code>resolve.conf</code>: local resolver info; what’s your DNS info</p>
<pre><code>man -f  resolv.conf
resolv.conf (5) - resolver configuration file
cat /etc/resolv.conf
resolvectl status</code></pre>
<h1 id="install-dns-server">Install DNS Server</h1>
<p>We will set up a DNS server and a client machine that uses the DNS server with Virtualbox. I’ve made some modifications, but overall I’m drawing upon the nice tutorial at <a href="https://fedoramagazine.org/how-to-setup-a-dns-server-with-bind/">fedora Magazine</a>.</p>
<h2 id="virtualbox-setup">VirtualBox Setup:</h2>
<p>In Virtualbox:</p>
<ol type="1">
<li>Click on your original Fedora OS install</li>
<li>Click on Settings -&gt; Network</li>
<li>Switch NAT to Bridged</li>
</ol>
<h2 id="update-server">Update Server</h2>
<p>Start and login to Fedora:</p>
<p>Switch to root account and update machine:</p>
<pre><code>sudo su
dnf -y upgrade</code></pre>
<p>After finished upgrading, power down the machine:</p>
<pre><code>poweroff</code></pre>
<h2 id="clone-server">Clone Server</h2>
<p>Next, in VirtualBox, clone your Fedora server two times and give them meaningful names.</p>
<ol type="1">
<li>Call the first one <strong>Fedora-DNS-Server</strong>.</li>
<li>Call the second one <strong>Fedora-DNS-Client</strong>.</li>
</ol>
<h2 id="fedora-dns-client">Fedora-DNS-Client</h2>
<p>Login to <strong>Fedora-DNS-Client</strong> and get the IP address:</p>
<pre><code>ip a
192.168.245.72/24</code></pre>
<h2 id="fedora-dns-server">Fedora-DNS-Server</h2>
<h3 id="install-and-configure-dns">Install and Configure DNS</h3>
<p>Keep that machine on but minimize it, and now login to <strong>Fedora-DNS-Server</strong>, get the IP address. Write these IP addresses down correctly.</p>
<pre><code>ip a
192.168.245.73/24</code></pre>
<p>On the <strong>Fedora-DNS-Server</strong> machine, install the DNS server software and utilities:</p>
<pre><code>sudo su
dnf install -y bind bind-utils</code></pre>
<p>Let’s create a new hostname for this server. I’ll name my DNS server after a Star Trek ship:</p>
<pre><code>hostname
hostnamectl set-hostname enterprise
hostname</code></pre>
<p>Now we need to edit some Bind configuration files. First we’ll edit <strong>named.conf</strong>:</p>
<pre><code>nano /etc/named.conf</code></pre>
<p>Go to this line:</p>
<pre><code>listen-on port 53 { 127.0.0.1; };</code></pre>
<p>Add the IP address for <strong>Fedora-DNS-Server</strong>. It should look like this, but you’ll have to use the IP address you got from <code>ip a</code> above, so that it looks like this. MAKE SURE you add the semicolons correctly–syntax is very important here:</p>
<pre><code>listen-on port 53 { 127.0.0.1; 192.168.254.73; };</code></pre>
<p>Next, go to this line:</p>
<pre><code>allow-query { localhost; };</code></pre>
<p>And add your network info:</p>
<pre><code>allow-query { localhost; 192.168.254.0/24; };</code></pre>
<p>Now we will set up forward and reverse zones. Forward zones map hostnames to IP addresses. Reverse zones map IP addresses to hostnames.</p>
<p>Go to this line:</p>
<pre><code>include &quot;/etc/named.rfc1912.zones&quot;;</code></pre>
<p>Directly <strong>above that line</strong>, add the following info. Substitute <strong>enterprrise</strong> for the hostname you created for your system. Note that the second zone is based on the IP address for <strong>Fedora-DNS-Server</strong>, but that it’s written in reverse and only the first three octets are used. You’ll have to do the same with the IP address for your <strong>Fedora-DNS-Server</strong>:</p>
<pre><code>zone &quot;dns01.enterprise&quot; IN {
type master;
file &quot;forward.enterprise&quot;;
allow-update { none; };
};

zone &quot;254.168.192.in-addr.arpa&quot; IN {
type master;
file &quot;reverse.enterprise&quot;;
allow-update { none; };
};</code></pre>
<p>Save and exit the file</p>
<h3 id="set-up-zone-files">Set up zone files</h3>
<p>The above modification refers to two zone files that are located in a different part of the filesystem. We’ll create these zone files:</p>
<p>Creat/open the forward zone file, but substitute <strong>enterprise</strong> for the hostname of your <strong>Fedora-DNS-Server</strong>:</p>
<pre><code>nano /var/named/forward.enterprise</code></pre>
<p>And add the following info to that file. Again, you’ll have to substitute <strong>enterprise</strong> for the hostname of your server. For the IP addresses, you’ll need to use the IP address for your <strong>Fedora-DNS-Server</strong> and your <strong>Fedora-DNS-Client</strong>. My server has the IP address of <strong>192.168.254.73</strong> and my client has the address <strong>192.168.254.72</strong>:</p>
<pre><code>$TTL 86400
@     IN          SOA     dns01.enterprise. root.enterprise. (
      2011071001  ;Serial
      3600        ;Refresh
      1800        ;Retry
      604800      ;Expire
      86400       ;Minimum TTL
)
; Name Server Info
@      IN          NS      dns01.enterprise.
; IP Address for Name Server
@      IN          A       192.168.254.73

dns01  IN          A       193.168.254.73
client IN          A       193.168.254.72</code></pre>
<p>Save and exit.</p>
<p>Repeat this process for the reverse zone file:</p>
<pre><code>nano /var/named/reverse.enterprise</code></pre>
<p>And add, again substituting the hostname and IP addresses with your hostname and respective IP addresses:</p>
<pre><code>$TTL 86400
@   IN  SOA     dns01.enterprise. root.enterprise. (
        2011071001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
; Name Server Info
@       IN  NS          dns01.enterprise.
; Reverse lookup for Name Server
@       IN  PTR         enterprise.local.

dns01           IN  A   192.168.254.73
client          IN  A   192.168.245.72
160     IN  PTR         dns01.enterprise.
136     IN  PTR         client.enterprise.</code></pre>
<p>Save and exit.</p>
<p>We’ll cover SELinux soon, but to take of that now, configure SELinux and fix ownership of the files:</p>
<pre><code>chgrp named -R /var/named
chown -v root:named /etc/named.conf
restorecon -rv /var/named
restorecon /etc/named.conf</code></pre>
<p>We’ll cover firewalls soon, but for now, update the firewall:</p>
<pre><code>firewall-cmd --add-service=dns --perm
firewall-cmd --reload</code></pre>
<p>We need to check for syntax errors in the configuration file. If there are no errors in the file, lothing will echo back. If there are errors, read the error message closely and fix the file after opening it in <code>nano</code>:</p>
<pre><code>named-checkconf /etc/named.conf</code></pre>
<p>Likewise, check for errors in the zone files:</p>
<pre><code>named-checkzone dns01.enterprise /var/named/reverse.enterprise
named-checkzone dns01.enterprise /var/named/forward.enterprise</code></pre>
<p>Enable and start the DNS server:</p>
<pre><code>systemctl enable named
systemctl start named</code></pre>
<p>Edit the <strong>resolv.conf</strong> (see <code>man resolv.conf</code>) and add the IP address for the server:</p>
<pre><code>nano /etc/resolv.conf
nameserver 192.168.254.73</code></pre>
<p>If there are nother nameservers listed in that file, comment them out by prepending the lines with a pound sign: <code>#</code>.</p>
<p>We can now check if our DNS server is working by examining the output of the <code>dig</code> command:</p>
<pre><code>dig fedoramazine.org</code></pre>
<h2 id="on-the-client-machine">On the client machine</h2>
<p>They are likely already installed, but in case it’s not, install the Bind utilities only:</p>
<pre><code>sudo dnf install -y bind-utils</code></pre>
<p>Edit <strong>resolv.conf</strong> so that nameserver points to the IP address of your <strong>Fedora-DNS-Server</strong>:</p>
<pre><code>sudo nano /etc/resolv.conf
nameserver 192.168.254.73</code></pre>
<p>Examine output of the <code>dig</code> command, which should show that it’s querying 192.168.254.73 for DNS:</p>
<pre><code>dig fedoramagazine.org</code></pre>
<p>We can also check the reverse DNS lookup:</p>
<pre><code>dig 35.196.109.67</code></pre>
<h2 id="make-permanent">Make Permanent</h2>
<p>As the <a href="https://fedoramagazine.org/how-to-setup-a-dns-server-with-bind/">fedora Magazine</a> article points out, the <strong>/etc/resolv.conf</strong> file will get reset upon reboot. To make sure the file doesn’t get altered, you can use the <code>chattr</code> command on both the server and client machines (and any other client machines). So run this command on both virtual machines:</p>
<pre><code>sudo chattr +i /etc/resolv.conf</code></pre>
<h1 id="local-security-chroot-example">Local Security: <code>chroot</code> example</h1>
<p><code>chroot</code> is a technology that can be used to change the “apparent” root <code>/</code> directory for a user or a process. A user or process that is confined to the <code>chroot</code> cannot see or access the rest of the file system and will have limited access to the binaries (executables/apps/utilities) on the system. From its <code>man</code> page:</p>
<pre><code>chroot (8) - run command or interactive shell with special root directory</code></pre>
<p>It has some useful use cases for security, although it is not entirely safe from tampering. I’ve read that some people have used <code>chroot</code> for DNS servers, for example.</p>
<p><code>chroot</code> is also the conceptual basis for some kinds of virtualization technologies that are common today. In this sense, it’s been used to control and provide a stable developmental environment for devops like work.</p>
<h2 id="chroot-a-current-user"><code>chroot</code> a current user</h2>
<p>In this tutorial, we are going to create a <code>chroot</code> for a human user account.</p>
<p><strong>Step 1</strong>: Let’s create a user first. We’re imagining that we have a preexisting user and that we need to <code>chroot</code> that user going forward.</p>
<pre><code>sudo su
useradd -m -U -s /bin/bash omicron
passwd omicron</code></pre>
<p><strong>Step 2</strong>: We’ll <code>chroot</code> <em>omicron</em> in a new directory <code>/var/chroot</code>.</p>
<pre><code>mkdir /var/chroot</code></pre>
<p><strong>Step 3</strong>: Set up available binaries for the user. We’ll only allow <code>bash</code> for now. To do that, we’ll create a <code>bin/</code> directory, and copy bash to that directory.</p>
<pre><code>mkdir /var/chroot/bin
which bash
/usr/bin/bash
cp /usr/bin/bash /var/chroot/bin/</code></pre>
<p><strong>Step 4</strong>: Copy the libraries for the bash binary.</p>
<pre><code># Identify libraries needed by Bash
ldd /usr/bin/bash
## comment: name it lib64 since these are all lib64 libraries
mkdir /var/chroot/lib64       
cp /lib64/libtinfo.so.6 /var/chroot/lib64/
cp /lib64/libdl.so.2 /var/chroot/lib64/
cp /lib64/libc.so.6 /var/chroot/lib64/
cp /lib64/ld-linux-x86-64.so.2 /var/chroot/lib64/</code></pre>
<p><strong>Step 5</strong>: Create and test the <code>chroot</code></p>
<pre><code>chroot /var/chroot/
bash-5.0# ls
bash: ls: command not found
bash-5.0# help
bash-5.0# dirs
bash-5.0# cd bin/
bash-5.0# dirs
bash-5.0# cd ../lib64/
bash-5.0# dirs
bash-5.0# cd ..
bash-5.0# exit</code></pre>
<p><strong>Step 6</strong>: Create a new group called <em>chrootjail</em>. We can add users to this group that we want to jail. Instructions are based on <a href="https://linuxconfig.org/how-to-automatically-chroot-jail-selected-ssh-user-logins">linuxconfig.org</a>.</p>
<pre><code>groupadd chrootjail
usermod -a -G chrootjail omicron
groups omicron</code></pre>
<p><strong>Step 7</strong>: Edit <code>/etc/ssh/sshd_config</code> to direct users in <code>chrootjail</code> group to <code>chroot</code> directory. Add the following line at the end of the file. Then restart ssh server.</p>
<pre><code># nano /etc/ssh/sshd_config
Match group chrootjail
            ChrootDirectory /var/chroot/</code></pre>
<p>Exit <code>nano</code>.</p>
<p>Restart <code>ssh</code>:</p>
<pre><code>systemctl restart sshd</code></pre>
<p>The logout of the server altogether:</p>
<pre><code>exit</code></pre>
<p><strong>Step 8</strong>: Test <code>ssh</code>.</p>
<p>Connect to the Fedora server via <code>ssh</code> as the user <em>omicron</em>:</p>
<pre><code>ssh omicron@relevant_ip_address
-bash-5.0$ ls
-bash: ls: command not found
exit</code></pre>
<p>That works as expected. The user <em>omicron</em> is now restricted to a special directory and has limited access to the system or to any utilities on that system.</p>
<h2 id="exercise">Exercise</h2>
<p>By using the <code>ldd</code> command, you can add additional binaries for this user. As an exercise, use the <code>ldd</code> command to locate the libraries for the <code>nano</code> editor, and make <code>nano</code> available to the user <em>omicron</em> in the chrooted directory.</p>
<h3 id="nano-in-chroot">Nano in chroot</h3>
<p>After making Bash available in <code>chroot</code>:</p>
<p>(Side note: I’m using the <strong>#</strong> sign below to indicate the root prompt.)</p>
<pre><code># which nano 
/usr/bin/nano
# cp /usr/bin/nano /var/chroot/bin/
# ldd /usr/bin/nano
linux-vdso.so.1 (0x00007fff5bdd5000)
    libmagic.so.1 =&gt; /lib64/libmagic.so.1 (0x00007f0ce11a7000)
    libncursesw.so.6 =&gt; /lib64/libncursesw.so.6 (0x00007f0ce1167000)
    libtinfo.so.6 =&gt; /lib64/libtinfo.so.6 (0x00007f0ce1138000)
    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f0ce0f6e000)
    libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f0ce0f54000)
    libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f0ce0f4d000)
    /lib64/ld-linux-x86-64.so.2 (0x00007f0ce1232000)
# cp /lib64/libmagic.so.1 /var/chroot/lib64/
# cp /lib64/libncursesw.so.6 /var/chroot/lib64/
# cp /lib64/libtinfo.so.6 /var/chroot/lib64/
# cp /lib64/libc.so.6 /var/chroot/lib64/
# cp /lib64/libz.so.1 /var/chroot/lib64/
# cp /lib64/libdl.so.2 /var/chroot/lib64/
# cp /lib64/ld-linux-x86-64.so.2 /var/chroot/lib64/
# chroot /var/chroot/
bash-5.0# nano
Error opening terminal: xterm-256color.
bash-5.0# exit</code></pre>
<p>To fix this, install <code>ncurses-term</code> and copy over additional files:</p>
<pre><code># dnf install -y ncurses-term
# locate xterm-256color
/usr/share/terminfo/s/screen.xterm-256color
/usr/share/terminfo/x/xterm-256color
# mkdir -p /var/chroot/etc/terminfo/x/
# cp /usr/share/terminfo/x/* /var/chroot/etc/terminfo/x/
# chroot /var/chroot
# nano</code></pre>
<h1 id="linux-firewalls">Linux Firewalls</h1>
<p><strong>See NFTABLES for changes to the firewall software</strong></p>
<p>Netfilter is a part of the kernel that includes a suite of applications that help manage how packets flow in and out of a server or internet connected device. <code>iptables</code> is the command line user interface to <strong>netfilter</strong> and is one of the main firewall applications on many Linux distributions.</p>
<p>Fedora/RedHat offers a more user friendly interface to <code>iptables</code> called <code>firewall-cmd</code> that I’ll discuss below. Ubuntu offers its own more user friendly interface called <code>ufw</code>. In this lecture, I’ll discuss <code>iptables</code> and <code>firewall-cmd</code>.</p>
<h2 id="iptables">iptables</h2>
<p>There are five predefined tables (<em>operations</em>) and five chains that come with <code>iptables</code>. Tables define the kinds of operations that you can use to control the firewall and therefore the packets that come in and out of the system or through a system. The <em>filter</em> and <em>nat</em> tables are the most commonly used ones.</p>
<p>The five <em>chains</em> are lists of rules that act on packets flowing through the system. Finally, there are also <em>targets</em>. These are the actions to be performed on packets. The main targets include <strong>ACCEPT</strong>, <strong>DROP</strong>, and <strong>RETURN</strong>.</p>
<p>From <code>man iptable</code>, the tables and respective chains include:</p>
<ul>
<li>filter (the default table)
<ul>
<li>INPUT: for packets destined to local sockets</li>
<li>FORWARD: for packets being routed through the box</li>
<li>OUTPUT: for locally-generated packets</li>
</ul></li>
<li>nat
<ul>
<li>PREROUTING: for altering packets as soon as they come in</li>
<li>INPUT: for altering packets destined for local sockets</li>
<li>OUTPUT: for altering locally-generated packets</li>
<li>POSTROUTING: for altering packets as they are about to go out</li>
</ul></li>
<li>mangle
<ul>
<li>PREROUTING</li>
<li>OUTPUT</li>
<li>INPUT</li>
<li>FORWARD</li>
<li>POSTROUTING</li>
</ul></li>
<li>raw
<ul>
<li>PREROUTING</li>
<li>OUTPUT</li>
</ul></li>
<li>security
<ul>
<li>INPUT</li>
<li>OUTPUT</li>
<li>FORWARD</li>
</ul></li>
</ul>
<p>We’ll cover the filter tables and the nat tables.</p>
<h3 id="usage">Usage</h3>
<p>First, we can look at the default parameters for the <em>filter</em> table. You need to be root to run this commands, or use <code>sudo</code>:</p>
<pre><code>sudo su
# -L: List all rules in the selected chain;
# if no chain is selected, then list all chains; and,
# -v: be verbose
iptables -L -v | less
iptables -L | grep policy</code></pre>
<h3 id="allow-connections-only-from-subnet">Allow connections only from subnet</h3>
<p>We can change the firewall to only allow communication on a subnet. Of course, in order to do this, we need the subnet <strong>Network ID</strong> and the <strong>CIDR</strong> number:</p>
<pre><code>ip a</code></pre>
<p>Now that we have the Network ID and the CIDR number, we can set the firewall:</p>
<pre><code># comment: first, set policy to drop all incoming, forwarding, and outgoing packets; this means we&#39;re starting from a baseline
iptables --policy INPUT DROP
iptables --policy FORWARD DROP
iptables --policy OUTPUT DROP

# comment: review new policies for the above chains
iptables -L | grep policy

# comment: now accept only input, forwarding, and output from the following
# comment: network ranges:

iptables -A INPUT -s 10.163.34.0/24 -j ACCEPT
iptables -A FORWARD -s 10.163.34.0/24 -j ACCEPT
iptables -A OUTPUT -s 10.163.34.0/24 -j ACCEPT</code></pre>
<p>To test this, we can try to connect to a remote server:</p>
<pre><code>w3m https://www.google.com</code></pre>
<p>There are lots of examples on the web. Examples from:</p>
<ul>
<li>http://www.tecmint.com/linux-iptables-firewall-rules-examples-commands/</li>
<li>https://www.howtogeek.com/177621/the-beginners-guide-to-iptables-the-linux-firewall/</li>
</ul>
<h3 id="prerouting">PREROUTING</h3>
<p>Here is another example where we forward all traffic to port 25 to port 2525. Here we use the <strong>NAT</strong> table, since NAT is responsible for network address translation:</p>
<pre><code>iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 25 -j REDIRECT --to-port 2525</code></pre>
<h3 id="output">OUTPUT</h3>
<p>Here is another example where we disable outgoing email by disabling the ports that are commonly associated with email. Of course, this could be bypassed by using non-standard ports for email, but for out cases, it’s a decent demonstration:</p>
<pre><code># iptables -A OUTPUT -p tcp --dports 25,465,587 -j REJECT</code></pre>
<h2 id="firewall-cmd">firewall-cmd</h2>
<p><a href="https://docs.fedoraproject.org/en-US/Fedora/19/html/Security_Guide/sect-Security_Guide-Using_Firewalls.html">firewall-cmd documentation</a></p>
<p><strong>firewalld</strong> is a slightly more user friendly interface to netfilters/iptables in Red Hat based distros.</p>
<p>Zones are an important concept in firewalld. Some predefined zones:</p>
<ul>
<li>DROP : strictest. All incoming network packets are dropped</li>
<li>BLOCK : all very strict</li>
<li>PUBLIC : only selected incoming connections are accepted. Good zone for web server, email server, etc.</li>
<li>EXTERNAL : external networks (useful for NAT)</li>
<li>DMZ : computers located in DMZ</li>
<li>work : trust most computers in network and accept some services</li>
<li>home : trust most computers in network and accept some services</li>
<li>trusted : trust all machines in network</li>
</ul>
<p>Check if running:</p>
<pre><code># firewall-cmd --state</code></pre>
<p>Get active zones and interfaces attached to them:</p>
<pre><code># firewall-cmd --get-zones
# firewall-cmd --get-default-zone
# firewall-cmd --get-active-zones
FedoraServer
  interfaces: enp0s3</code></pre>
<p>Allow port 22, list ports, remove services by name, add services by name:</p>
<pre><code># firewall-cmd --zone=FedoraServer --add-port=22/tcp
# firewall-cmd --zone=FedoraServer --list-ports
# firewall-cmd --zone=FedoraServer --remove-service=ssh --permanent
# firewall-cmd --zone=FedoraServer --add-service=smtp --permanent
# firewall-cmd --reload</code></pre>
<p>Go into panic mode (drop all incoming/outgoing packets):</p>
<pre><code># firewall-cmd --panic-on
# firewall-cmd --panic-off</code></pre>
<p>To change default zone:</p>
<pre><code># firewall-cmd --permanent --set-default-zone=public</code></pre>
<h1 id="installing-apache2">Installing Apache2</h1>
<p>Let’s install our first web server. First, make sure your machine is up to date before installing Apache2.</p>
<p>First, be sure to switch to Bridged mode in VirtualBox network settings and refresh MAC address in VirtualBox.</p>
<h2 id="update-system-first">Update system first</h2>
<p>Login as root, or switch to the <code>root</code> user, and update the machine:</p>
<pre><code>sudo su
dnf update</code></pre>
<h2 id="install-httpd">Install <code>httpd</code></h2>
<p>Now, that the machine is updated. Let’s install Apache2. On distributions that use a package management system, such as <code>dnf</code> on Fedora and <code>apt</code> on Ubuntu, we can use those systems to install the relevant software and dependencies. However, different distributions use different names for the packages. Fedora refers to the Apache2 software as <code>httpd</code> while Ubuntu refers to it as <code>Apache2</code>. We can use <code>dnf</code> to search for the appropriate package name:</p>
<pre><code>dnf search apache | grep &quot;httpd&quot;</code></pre>
<p>Apache2 is not the only web server available. <a href="https://nginx.org/en/">nginx</a> is another popular web server, and you should explore or learn about other options on your own. For now, let’s get some basic info on the <code>httpd</code> package:</p>
<pre><code>dnf info httpd</code></pre>
<p>Based on the output, and at the time of this writing, it looks like the <code>httpd</code> package refers to the Apache HTTP Server, version 2.4.46. I wanted to highlight this because it’s important to know what version of things are that we’re installing, for a couple of reasons at least. First, although Apache2 has its own dependencies, other packages will also depend on it. For example, say we wanted to install Drupal or WordPress, we would first have to install a web server, like Apache2, and it might be the case that Drupal or WordPress require a certain minimum version of Apache2. Second, some Linux operating systems focus on stability and thus do not update to the most recent version of a package instead opting for the most stable version of the software. The <a href="https://httpd.apache.org/">latest stable release of Apache2</a> is 2.4.46. But it’s not always likely that Fedora or some other distribution will use that or some newer version until the next distribution upgrade, for example, from Fedora 32 to Fedora 33. For now, however, this is fine, and we can proceed with the install:</p>
<pre><code>dnf -y install httpd</code></pre>
<h2 id="basic-checks">Basic checks</h2>
<p>One of the things that makes Apache2, and some other web servers, so powerful is the library of modules that extend Apache’s functionality. We’ll come back to modules soon. For now, we’re going to make sure the server is up and running, configure some basic things, and then create a basic web site.</p>
<p>To start, let’s make sure that Apache2 is <em>enabled</em> and <em>running</em> (note that I truncate some output below using <code>...</code>:</p>
<pre><code>systemctl list-unit-files httpd.service

UNIT FILE       STATE     VENDOR PRESET
httpd.service   disabled  disabled

1 unit files listed.

systemctl enable httpd.service
systemctl list-unit-files httpd.service

UNIT FILE       STATE
httpd.service   enabled  disabled

1 unit files listed.

systemctl status httpd.service
...
Active: inactive (dead)
...

systemctl start httpd.service
systemctl status httpd.service
...
Active: active (running)
...</code></pre>
<h2 id="creating-a-web-page">Creating a web page</h2>
<p>Now that we have it up and running, let’s look at the default web page:</p>
<pre><code>dnf install -y w3m
w3m http://127.0.0.1</code></pre>
<p>The <code>w3m</code> text-mode browser shows the <strong>Fedora Test Page</strong>. That’s a sign that the default install was successful. Let’s now create our first web page. To do so, we need to know what directory that <code>httpd</code> is using to serve websites. If we read through that <strong>Fedora Test Page</strong> document, it’ll tell us that the default directory is <code>/var/www/html/</code>. Let’s go there and create a webpage with our text editor of choice:</p>
<pre><code>cd /var/www/html/
nano index.html</code></pre>
<p>Then create a simple HTML page, something like this. Of course, modify the content to suit your own interests:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;My first web page using Apache2&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;Welcome&lt;/h1&gt;

&lt;p&gt;Welcome to my web site. This is the first web page I have ever created using
Apache2 and Fedora Linux. If you have any questiosn, please email me at &lt;a
href=&quot;mailto:sean.burns@uky.edu&quot;&gt;sean.burns@uky.edu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Dr. Burns&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>After you’re done, save and close the document. Let’s visit our website again with <code>w3m</code> to see if it works:</p>
<pre><code>w3m http://127.0.0.1</code></pre>
<p>Let’s open the firewall so that outside systems can access this page:</p>
<pre><code>firewall-cmd --list-all
firewall-cmd --get-active-zones
firewall-cmd --zone=FedoraServer --add-service=http
firewall-cmd --zone=FedoraServer --add-service=https
firewall-cmd --runtime-to-permanent</code></pre>
<h2 id="changing-the-hostname">Changing the <code>hostname</code></h2>
<p>The <code>hostname</code> of a system is the label it uses to identify itself to others (humans) on the network. If the hostname is on the web, it may also be referred to as a domain name or may be part of the fully qualified domain name, which we studied during the DNS and networking weeks. For example, on <strong>SISED</strong>, the hostname is <code>sised</code> and <strong>SISED</strong>’s fully qualified domain name, when part of the Internet, is <strong>sised.is.uky.edu</strong>.</p>
<p>We’re going to check and set the system <code>hostname</code> on our Fedora (virtual) machines using the <code>hostname</code> command:</p>
<p>Check the default hostname:</p>
<pre><code># hostname
localhost.localdomain</code></pre>
<p>To change the default hostname from <strong>localhost</strong>, we’ll edit a specific file and then use the <code>hostname</code> command to update the system’s hostname per the file. I’ll comment out the first line by putting a pound sign at the beginning and then add an additional line with the name of my new hostname: <strong>csbhome</strong>. You can name your hostname whatever you want, but be sure it’s a single word with no punctuation.</p>
<pre><code>hostnamectl set-hostname seanburns
hostname
cat /etc/hostname</code></pre>
<p>We can access our site by hostname rather than by IP:</p>
<pre><code>w3m seanburns</code></pre>
<h2 id="optional">Optional</h2>
<p>After you’ve completed the above steps, do the following:</p>
<ol type="1">
<li>On your host machine, find your OS’s version of <code>/etc/hosts</code>. For example, it seems Windows users can follow these instructions: <a href="https://gist.github.com/zenorocha/18b10a14b2deb214dc4ce43a2d2e2992">https://gist.github.com/zenorocha/18b10a14b2deb214dc4ce43a2d2e2992</a>. macOS users can follow these instructions also have an <code>/etc/hosts</code>.</li>
<li>Map your guest IP address to your new hostname:</li>
</ol>
<pre><code>192.168.4.31 seanburns</code></pre>
<p>Then, in your Firefox, Chrome, or whatever browser, visit your new website and replace ‘seanburns’ with the hostname that you chose for your guest OS:</p>
<pre><code>http://seanburns</code></pre>
<h1 id="apache2-user-directories">Apache2 User Directories</h1>
<p>We can enable Apache2 so that users on our systems can run websites from their home directories.</p>
<h2 id="enable-userdir-homepublic_html-sites">Enable userdir (<code>$HOME/public_html</code> sites)</h2>
<p>Edit the <code>userdir.conf</code> file.</p>
<pre><code>cd /etc/httpd/conf.d/
nano userdir.conf</code></pre>
<p>Make the following changes:</p>
<ul>
<li><code>UserDir disabled</code> to <code>UserDir enabled</code></li>
<li>Uncomment line <code>UserDir public_html</code></li>
</ul>
<p>After saving and exiting, restart <code>httpd.service</code>:</p>
<pre><code>systemctl restart httpd.service</code></pre>
<h3 id="tasks">Tasks</h3>
<ol type="1">
<li>Exit out of root account</li>
<li>Go to your regular user’s home directory</li>
<li>Make a directory titled <code>public_html</code></li>
<li>Change <code>public_html</code> directory permissions to 755: <code>chmod 755 public_html</code></li>
<li>Change user director permissions to 711: <code>chmod 711 /home/sean</code></li>
</ol>
<h3 id="selinux">SELinux</h3>
<p>Now, because of SELinux, we need to set some SELinux switches. Using <code>sudo</code> or logging in as <code>root</code>:</p>
<pre><code>setsebool -P httpd_enable_homedirs true
chcon -R -t httpd_sys_content_t /home/sean/public_html</code></pre>
<p>In the last line above, replace <code>/home/sean/public_html</code> with the correct path for your regular user (i.e., you’re not <em>sean</em>). Exit out of root if you need to.</p>
<h3 id="test-1">Test</h3>
<p>Now test to see if your <code>public_html</code> site is operational by simply visiting the site. For me, I use the following command:</p>
<pre><code>cd ~/public_html/
echo &quot;&lt;p&gt;Hello world&lt;/p&gt;&quot; &gt;&gt; index.html
w3m http://127.0.0.1/~sean</code></pre>
<h1 id="installing-and-setting-php-for-apache">Installing and Setting PHP for Apache</h1>
<p>PHP is a server-side programming language, which means that unlike client-side programming languages, like JavaScript, PHP code must be installed on the server and made to work with the Apache <code>httpd</code> server. In order for Apache and PHP to work together, we will need to install some PHP software. We’ll make some modifications to Apache so that it defaults to PHP files rather than to HTML files.</p>
<p>To get started, let’s work with last week’s HTTP machine that we used to set up Apache and user directories <code>userdir</code>. You can use that machine or you can clone it to be sure that you have a good backup in case you need to start over.</p>
<p>Let’s find the relevant packages to install. Again, make sure your system is up to date first.</p>
<pre><code>sudo su
dnf -y upgrade
dnf search php | less
dnf info php
... (not displaying output)
dnf info php-common
... (not displaying output)
dnf install php php-common</code></pre>
<p>Since we are altering how the Apache <code>httpd</code> service functions, we will need to restart the service. To check and restart services:</p>
<pre><code>systemctl status httpd.service
systemctl restart httpd.service
systemctl status httpd.service</code></pre>
<p>If all is well, our next task is to see if the Apache <code>httpd</code> service recognizes PHP. We will proceed to the base HTTP directory, and use <code>nano</code> to create and open a file called <code>info.php</code>.</p>
<pre><code>cd /var/www/html/
nano info.php</code></pre>
<p>To make sure that the Apache web server can recognize that PHP is installed and usable, we can add a little test code to the <code>info.php</code> file. The test code will give us information about the version of PHP that we just installed:</p>
<pre><code>&lt;?php
phpinfo();
?&gt;</code></pre>
<p>Next, let’s update file ownership for all files in this directory. They should be owned be the Apache user:</p>
<pre><code>ls -l
chown apache:apache *
ls -l
w3m http://localhost/info.php</code></pre>
<p>By default, if both an <strong>index.html</strong> file and an <strong>index.php</strong> file exist in the same directory, the Apache web server will display the <strong>index.html</strong> file if a user visits the directory (e.g., http://example.com/ or http://localhost/). So we need to configure Apache to display <em>index.php</em> files before displaying <em>index.html</em> files in case both files exist in the same directory:</p>
<pre><code>cd /etc/httpd/conf/
nano httpd.conf</code></pre>
<p>Change this line:</p>
<pre><code>DirectoryIndex index.html</code></pre>
<p>To (that is, add <strong>index.php</strong> file to the line and make sure that it comes before <strong>index.html</strong>:</p>
<pre><code>DirectoryIndex index.php index.html</code></pre>
<p>Since we have modified an Apache configuration file, we should check that we haven’t made a syntax mistake:</p>
<pre><code>apachectl configtest</code></pre>
<p>If we get an <strong>Syntax Ok</strong> message (you can ignore the FQDN error message), you can tell Apache to reload its config files:</p>
<pre><code>systemctl reload httpd.service
systemctl restart httpd.service</code></pre>
<p>Now let’s create a basic PHP page. Let’s <code>cd</code> back to the base HTTP directory and use <code>nano</code> to create and open and <code>index.php</code> file:</p>
<pre><code>cd /var/www/html/
nano index.php</code></pre>
<p>Let’s add some HTML and PHP that will detect our browser to the <strong>index.php</strong> (<a href="https://stackoverflow.com/questions/8754080/how-to-get-exact-browser-name-and-version">Source code link</a>):</p>
<pre><code>&lt;p&gt;You are using the following browser to view this site:&lt;/p&gt;

&lt;?php
echo $_SERVER[&#39;HTTP_USER_AGENT&#39;] . &quot;\n\n&quot;;

$browser = get_browser(null, true);
print_r($browser);
?&gt;</code></pre>
<p>Next, save and exit <code>nano</code>, change ownership of the file to Apache, and view with <code>w3m</code>:</p>
<pre><code>chown apache:apache index.php
w3m http://localhost/</code></pre>
<p>Of course, since we set up our hostname last week, we can use our hostname in our URL:</p>
<pre><code>w3m http://seanburns/</code></pre>
<p><strong>Your goal:</strong></p>
<ul>
<li>Create an <strong>index.php</strong> file in your <strong>userdir</strong></li>
<li>Add some PHP and submit screenshots, like last week, showing both the code and the output.</li>
</ul>
<p>Get some sample PHP code from here: <a href="https://www.w3schools.com/php/php_syntax.asp">https://www.w3schools.com/php/php_syntax.asp</a></p>
<h1 id="apache2-virtualhosts">Apache2 VirtualHosts</h1>
<h2 id="update-os">Update OS</h2>
<p>As always, let’s update Fedora:</p>
<pre><code>dnf upgrade</code></pre>
<h2 id="create-new-configurations">Create new configurations</h2>
<p>So far we have learned how to create a main website at <strong>/var/www/html</strong> and then user websites at <strong>/home/${USER}/public_html/</strong>. Websites that are stored at <strong>/var/www/html</strong> can eventually have a domain name like <strong>example.org</strong> or <strong>biguniversity.edu</strong>. And then websites at <strong>/home/${USER}/public_html/</strong> would have URLs like <strong>http://biguniversity.edu/~USER</strong>. The problem with creating a website at <strong>/var/www/html</strong> is that, by default, we can only use our machines to create the one main site, so either <strong>example.org</strong> or <strong>biguniversity.edu</strong> but not both.</p>
<p><em>VirtualHosts</em> solve this problem and allow a single server, with a single IP address, to host websites linked to multiple domain names, and all of them would be stored in the <strong>/var/www/html</strong> directory.</p>
<p>To start, we need to go back to the Apache configuration files and add information about the virtual hosts that we want to create. We have two choices about which files we can edit to include this information.</p>
<p>First choice, we can add virtual host information to the following file:</p>
<p><strong>/etc/httpd/conf/httpd.conf</strong></p>
<p>However, that same file includes a line (the <code>IncludeOptional conf.d/*.conf</code> line) that tells the Apache service to look for additional configuration files for in the <strong>/etc/conf.d/</strong> directory. Per that above line, the files need to end with <strong>.conf</strong>. This is the cleaner and more manageable method and we’ll follow that process.</p>
<p>To get started, we’ll name the files after some pretend domain names but domain names that we might actually want to have. I’ll create a domain called <strong>linuxsysadmins.com</strong> and another one called <strong>websysadmins.com</strong>:</p>
<pre><code>cd /etc/httpd/conf.d/
touch linuxsysadmins.conf</code></pre>
<p>In the <strong>linuxsysadmins.conf</strong> file, I’ll add the following info:</p>
<pre><code>&lt;VirtualHost *:80&gt;
ServerAdmin webmaster@linuxsysadmins.com
DocumentRoot &quot;/var/www/html/linuxsysadmins/&quot;
ServerName linuxsysadmins.com
ServerAlias www.linuxsysadmins.com
ErrorLog &quot;/var/log/httpd/linuxsysadmins.com-error_log&quot;
CustomLog &quot;/var/log/httpd/linuxsysadmins.com-access_log&quot; combined

&lt;Directory &quot;/var/www/html/linuxsysadmins/&quot;&gt;
DirectoryIndex index.html index.php
Options FollowSymLinks
AllowOverride All
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
<p>Then I’ll repeat the process with a new file called <strong>websysadmins.conf</strong>. I can simply copy <strong>linuxsysadmins.conf</strong> to <strong>websysadmins.conf</strong>.</p>
<pre><code>cp linuxsysadmins.conf websysadmins.conf</code></pre>
<p>And edit the file accordingly:</p>
<pre><code>&lt;VirtualHost *:80&gt;
ServerAdmin webmaster@websysadmins.com
DocumentRoot &quot;/var/www/html/websysadmins/&quot;
ServerName websysadmins.com
ServerAlias www.websysadmins.com
ErrorLog &quot;/var/log/httpd/websysadmins.com-error_log&quot;
CustomLog &quot;/var/log/httpd/websysadmins.com-access_log&quot; combined

&lt;Directory &quot;/var/www/html/websysadmins/&quot;&gt;
DirectoryIndex index.html index.php
Options FollowSymLinks
AllowOverride All
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
<p>When done, I’ll exit out of my text editor and check the configuration syntax with one of the following two commands:</p>
<pre><code>httpd -t
apachectl configtest</code></pre>
<p>You should get an error stating that the sites don’t exist at the <strong>DocumentRoot</strong>, but we’ll fix that in a second. For now, you want to get a <code>Syntax OK</code> message.</p>
<h2 id="creating-the-sites">Creating the sites</h2>
<p>Now, the above two files tell Apache2 to look for the respective websites in <code>/var/www/html/your_domain</code>. This is our <strong>DocumentRoot</strong>, i.e., the base directory for our websites. We need to create those locations. I’ll do that now for my two domains, and I’ll use a new trick, called brace expansion, to create both at the same time:</p>
<pre><code>mkdir /var/www/html/{linuxsysadmins,websysadmins}</code></pre>
<p>The above command creates:</p>
<ul>
<li>/var/www/html/linuxsysadmins</li>
<li>/var/www/html/websysadmins</li>
</ul>
<p>Now let’s create some basic web pages in each domain directory:</p>
<pre><code>cd /var/www/html/linuxsysadmins
echo &quot;&lt;h1&gt;Linux Sys Admins&lt;/h1&gt;&quot; &gt;&gt; index.html</code></pre>
<p>Then <code>cd</code> to <strong>websysadmins</strong> from the <strong>linuxsysadmins</strong> directory:</p>
<pre><code>cd ../websysadmins
echo &quot;&lt;h1&gt;Web Sys Admins&lt;/h1&gt;&quot; &gt;&gt; index.html</code></pre>
<p>And now we have to make sure that the user <code>apache</code> owns those two directories and all future files in them. We use the user <code>apache</code> because the main Apache2 configuration file (<code>/etc/httpd/conf/httpd.conf</code>) has two directives that state that the names of the User/Group should be <code>apache</code>:</p>
<pre><code>cd .. # to return to the parent directory
chgrp -R apache /var/www/html/
chmod 2775 -R /var/www/html</code></pre>
<p>By adding our account to the <code>apache</code> group, we can edit these and all future files without using <code>sudo</code> or becoming <code>root</code>:</p>
<pre><code>usermod -aG apache $USER</code></pre>
<p>You can run <code>ls -l</code> on those directories and files to confirm that the <code>apache</code> owner owns them. You can also run <code>httpd -t</code> or <code>apachectl configtest</code> again to confirm that all the syntax is good.</p>
<h2 id="the-hosts-file-etchosts">The Hosts File: <code>/etc/hosts</code></h2>
<p>In order to resolve IP address to domain names, we need some kind of system that will map these two identifiers to each other. We have already covered DNS more extensively, but here we’ll do something more basic.</p>
<p>The <code>/etc/hosts</code> file is like a basic DNS system and we can use it as a “static table lookup for hostnames” (from <code>man hosts</code>). Let’s modify this so that our IP address is mapped to the our domain names. To do that, let’s add the following line just after the two localhost lines: (<strong>USE YOUR IP NOT MINE</strong>)</p>
<pre><code>ip a
192.168.4.32
sudo nano /etc/hosts</code></pre>
<p>Then let’s map your IP address to a hostname that we’ll use for a new website. Add the following to <code>/etc/hosts</code>, but replace my IP with yours and my hostname with one of your own creation:</p>
<pre><code>192.168.4.32 linuxsysadmins.com
192.168.4.32 websysadmins.com</code></pre>
<p>This is one way to create a kind of intranet that uses actual names instead of just IP addresses. Say that you have a home network and one of the computers on your network is running a web server. If you assign a static IP to this computer using the software on your home router, modify the <code>/etc/hosts</code> files on each of those three computers to point to that static IP via a domain name, then you have basic DNS system for your intranet.</p>
<p>Now, let’s restart Apache2 and see if we can visit our sites.</p>
<pre><code>systemctl reload httpd.service
systemctl restart httpd.service
w3m http://linuxsysadmins.com
w3m http://websysadmins.com</code></pre>
<p>Success!</p>
<p>If you change the <code>/etc/hosts</code> file on your <strong>host</strong> machine (i.e., your laptop) per the instructions in the last lecture, then you should be able to visit <strong>http://linuxsysadmins.com</strong> and <strong>http://websysadmins.com</strong> in your browser. Here is a snippet of what my <code>/etc/hosts</code> file looks like on my desktop machine (i.e., my <strong>host</strong> machine):</p>
<pre><code>127.0.0.1         localhost
127.0.1.1         desktop
192.168.4.32    linuxsysadmins.com
192.168.4.32    websysadmins.com</code></pre>
<h2 id="references">References</h2>
<ul>
<li><a href="https://httpd.apache.org/docs/2.2/vhosts/name-based.html">Name-based Virtual Host Support</a></li>
<li><a href="https://httpd.apache.org/docs/2.4/vhosts/examples.html">VirtualHost Examples</a></li>
<li><a href="https://www.rosehosting.com/blog/apache-virtual-hosts-on-centos/">How to set up Apache Virtual Hosts on CentOS 7</a></li>
</ul>
<h1 id="mysql-server-administration">MySQL Server Administration</h1>
<h2 id="install-and-set-up-mysql">Install and Set Up MySQL</h2>
<p>This week we’ll learn how to install, setup, secure, and configure the MySQL relational database so that it works with the Apache2 web server. First, a point on terms. This week we will be working as</p>
<ul>
<li>the Linux root user <strong>and as</strong></li>
<li>the MySQL root user.</li>
</ul>
<p>These are two different things and accounts. In Linux, there is the <strong>root</strong> user and there is also the <strong>root</strong> directory. In MySQL and other relational database software, there is also a <strong>root</strong> user and this user is not the same as the Linux <strong>root</strong> user. They will have different passwords, for example. It’s important to keep these concepts separate in our heads, and for most of this transcript, I will refer to the MySQL root user, unless otherwise specified.</p>
<p>First, let’s install MySQL Community Server, and then log into the MySQL shell under the <strong>MySQL root</strong> account.</p>
<pre><code>sudo su
dnf upgrade
dnf search mysql server
dnf info community-mysql-server
dnf info community-mysql-server
dnf install community-mysql-server
systemctl list-unit-files mysqld.service
systemctl status mysqld.service
systemctl start mysqld.service
systemctl enable mysqld.service
systemctl status mysqld.service
systemctl list-unit-files mysqld.service
mysql -u root</code></pre>
<p>After we have logged in, we need to create a secure password for the <strong>MySQL root</strong> account. Note again that this is not the same as the <strong>root</strong> account on the Linux system. That is, these are two different accounts: <em>Linux root</em> and <em>MySQL root</em>. Once we have created the password, we will exit MySQL.</p>
<p>To change the MySQL root password where the password is simply “aNewPassword4!” (withouth the quotes) and then log out (in a production environment, there’s no way I would use a basic password like this—here I’m simply trying to keep things simple):</p>
<pre><code>mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;aNewPassword4!&#39;;
mysql&gt; \q</code></pre>
<h2 id="secure-mysql-server">Secure MySQL Server</h2>
<p>Now we use a MySQL program called <code>mysql_secure_installation</code> to help secure the MySQL installation. From the Bash shell, run the following command as the <strong>Linux root user</strong>, and then respond to the command line prompts as follows:</p>
<pre><code># mysql_secure_installation
Enter password for user root: aNewPassword4!
Validate Password: Y
Password Strength: 1
Change the password for root: N
Remove anonymous users: y
Disallow root login remotely: y
Remove test database: y
Reload privilege tables now: y</code></pre>
<h2 id="create-and-set-up-a-regular-user-account">Create and Set Up a Regular User Account</h2>
<p>Now, log back into the MySQL shell as the <em>MySQL root</em> user. Here the command is a bit different from the first one that we used to login to MySQL because we now have to enter our password:</p>
<pre><code>mysql -u root -p</code></pre>
<p>In MySQL, we will create and set up a new account that is not <strong>root</strong> and therefore does not have <strong>root</strong> privileges:</p>
<pre><code>mysql&gt; create user &#39;sean&#39;@&#39;localhost&#39; identified by &#39;an0ldP4ssPhrase!&#39;;</code></pre>
<h2 id="create-a-practice-database">Create a Practice Database</h2>
<p>Now let’s create a pet database for user ‘sean’. This user will be granted all privileges on this database, including all tables in it. Other than granting all privileges, we could also grant specific privileges, including: CREATE, DROP, DELETE, INSERT, SELECT, UPDATE, and GRANT OPTION. Such privileges may be called operations or functions. They allow MySQL users to use and modify the database:</p>
<p>Don’t use this exact command, but the syntax of the <code>grant</code> command below is this:</p>
<pre><code>grant PRIVILEGE_OPTION on DATABASE.TABLE to &#39;USER&#39;@&#39;LOCALHOST&#39;;</code></pre>
<p>In practice, we do this:</p>
<pre><code>mysql&gt; create database pets;
mysql&gt; grant all privileges on pets.* to &#39;sean&#39;@&#39;localhost&#39;;
mysql&gt; show databases;
mysql&gt; \q</code></pre>
<h3 id="logging-in-as-regular-user-and-creating-tables">Logging in as Regular User and Creating Tables</h3>
<p>Now, we can start doing MySQL work. As <strong>root</strong>, we’ve created a new MySQL user named <strong>sean</strong> and a new database for <strong>sean</strong> that is called <strong>pets</strong>. Let’s login under our Linux accounts, for me that’s <strong>sean</strong>, and create data for our database:</p>
<pre><code>$ mysql -u sean -p
mysql&gt; show databases;
mysql&gt; use pets;
mysql&gt; create table cats
    -&gt; (
    -&gt; id int unsigned not null auto_increment,
    -&gt; name varchar(150) not null,
    -&gt; owner varchar(150) not null,
    -&gt; birth date not null,
    -&gt; primary key (id)
    -&gt; );
Query OK, 0 rows affected (0.07 sec)

mysql&gt; show tables;
mysql&gt; describe cats;</code></pre>
<p>Congratulations! If you haven’t used MySQL or like technology before, then you’ve created your first database and a table in that database. Let’s create some records for that table.</p>
<h3 id="adding-records-into-the-table">Adding records into the table</h3>
<p>We’ll use the INSERT command to add records:</p>
<pre><code>mysql&gt; insert into cats (name, owner, birth) values
    -&gt; (&#39;Sandy&#39;, &#39;Lennon&#39;, &#39;2015-01-03&#39;),
    -&gt; (&#39;Cookie&#39;, &#39;Casey&#39;, &#39;2013-11-13&#39;),
    -&gt; (&#39;Charlie&#39;, &#39;River&#39;, &#39;2016-05-21&#39;);
Query OK, 3 rows affected (0.06 sec)
Records: 3  Duplicates: 0  Warnings: 0
mysql&gt; select * from cats;</code></pre>
<p>Success! Now let’s play around with our table. We will issues some queries on the data to retrieve some records or parts of records, we will delete a record, alter the table structure so that it will hold more data, and add a record:</p>
<pre><code>mysql&gt; select owner from cats;
mysql&gt; select birth from cats;
mysql&gt; select name, owner from cats;
mysql&gt; select name from cats;
...
mysql&gt; select name from cats where name=&#39;Sandy&#39;;
...
mysql&gt; select owner from cats where name=&#39;Cookie&#39;;
...
mysql&gt; delete from cats where name=&#39;Cookie&#39;;
mysql&gt; select /* from cats;
mysql&gt; alter table cats add gender char(1) after name;
mysql&gt; describe cats;
mysql&gt; update cats set gender=&quot;F&quot; where id=&quot;1&quot;;
mysql&gt; update cats set gender=&quot;M&quot; where id=&quot;3&quot;;
mysql&gt; select * from cats;
mysql&gt; insert into cats (name, gender, owner, birth) values
    -&gt; (&#39;Bob&#39;, &#39;M&#39;, &#39;Alice&#39;, &#39;2009-10-01&#39;);
mysql&gt; select * from cats;
mysql&gt; select name, gender from cats where birth &lt; &#39;2015-01-01&#39;;
mysql&gt; \q</code></pre>
<h2 id="references-and-read-more">References and Read More</h2>
<ol type="1">
<li><a href="https://dev.mysql.com/doc/mysql-getting-started/en/">MySQL: Getting Started with MySQL</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-new-user-and-grant-permissions-in-mysql">How to Create a New User and Grant Permissions in MySQL</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/sql-syntax.html">MySQL: MySQL 5.7 Reference Manual: 13 SQL Statement Syntax</a></li>
</ol>
<h1 id="install-php-and-mysql-support">Install PHP and MySQL Support</h1>
<p>The goal here is to complete the connection between PHP and MySQL so that we can use both for our websites.</p>
<p>First install MySQL support for PHP. We’re installing some modules alongside the basic support. These may or may not be needed, but I’m installing them to demonstrate some basics. Use <code>dnf info &lt;packagename&gt;</code> to get information about each package before installing.</p>
<pre><code>sudo su
dnf install php-mysqlnd php-cli php-mbstring php-fpm
systemctl restart mysqld.service
systemctl restart httpd.service</code></pre>
<h2 id="create-php-scripts">Create PHP Scripts</h2>
<p>Let’s move to the base web directory and create our login file, which will contain the credentials for our <em>MySQL</em> account. In the previous week, I demonstrated virtualhosts. We’ll use one of our virtual domains to connect to our MySQL server with PHP.</p>
<pre><code>cd /var/www/html/linuxsysadmins/
touch login.php
chmod 640 login.php
ls -l login.php
nano login.php</code></pre>
<p>In the file, add the following credentials, substituting your credentials where necessary:</p>
<pre><code>&lt;?php // login.php
$db_hostname = &quot;localhost&quot;;
$db_database = &quot;pets&quot;;
$db_username = &quot;sean&quot;;
$db_password = &quot;an0ldP4ssPhrase!&quot;;
?&gt;</code></pre>
<p>Now, in a separate file, which will be <strong>index.php</strong>, I’ll add the following PHP to test our database connection and return some results:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;&lt;title&gt;MySQL Server Example&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;

&lt;?php

// Load MySQL credentials
require_once &#39;login.php&#39;;

// Establish connection
$conn = mysqli_connect($db_hostname, $db_username, $db_password) or
    die(&quot;Unable to connect&quot;);

// Open database
mysqli_select_db($conn, $db_database) or
    die(&quot;Could not open database &#39;$db_database&#39;&quot;);

// QUERY 1
$query1 = &quot;show tables from $db_database&quot;;
$result1 = mysqli_query($conn, $query1);

$tblcnt = 0;
while($tbl = mysqli_fetch_array($result1)) {
    $tblcnt++;
}

if (!$tblcnt) {
    echo &quot;&lt;p&gt;There are no tables&lt;/p&gt;\n&quot;;
}
else {
    echo &quot;&lt;p&gt;There are $tblcnt tables&lt;/p&gt;\n&quot;;
}

// Free result1 set
mysqli_free_result($result1);

// QUERY 2
$query2 = &quot;select name, owner from cats&quot;;
$result2 = mysqli_query($conn, $query2);

$row = mysqli_fetch_array($result2, MYSQLI_NUM);
printf (&quot;%s (%s)\n&quot;, $row[0], $row[1]);
echo &quot;&lt;br/&gt;&quot;;

$row = mysqli_fetch_array($result2, MYSQLI_ASSOC);
printf (&quot;%s (%s)\n&quot;, $row[&quot;name&quot;], $row[&quot;owner&quot;]);

// Free result2 set  
mysqli_free_result($result2);

// Query 3
$query3 = &quot;select * from cats&quot;;
$result3 = mysqli_query($conn, $query3);

while($row = $result3-&gt;fetch_assoc()) {
    echo &quot;&lt;p&gt;Owner &quot; . $row[&quot;owner&quot;] . &quot; has pet &quot; . $row[&quot;name&quot;] . &quot;.&lt;/p&gt;&quot;;
}

mysqli_free_result($result3);

$result4 = mysqli_query($conn, $query3);
while($row = $result4-&gt;fetch_assoc()) {
    echo &quot;&lt;p&gt;Pet &quot; . $row[&quot;name&quot;] . &quot; was born on &quot; . $row[&quot;birth&quot;] . &quot;.&lt;/p&gt;&quot;;
}

// Free result4 set  
mysqli_free_result($result4);

/* Close connection */
mysqli_close($conn);

?&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>After you save the file and exit the text editor, we can test the PHP syntax by doing the following. If there are any errors in our PHP, these commands will show the line numbers that are causing errors or leading up to errors. If all is well with the first command, nothing will output. If all is well with the second command, HTML should be outputted:</p>
<pre><code>php -f login.php
php -f index.php
chmod g+r \*php</code></pre>
<p>Next we need to update our configuration file for our linuxsysadmin virtualhost, and reverse the order of the <strong>DirectoryIndex</strong> field so that <strong>index.php</strong> is listed before <strong>index.html</strong>. Then restart <strong>httpd.service</strong>.</p>
<pre><code>cd /etc/httpd/conf.d/
nano linuxsysadmin.conf
...
httpd -t
systemctl restart httpd.service</code></pre>
<h2 id="check-ip-and-hostname">Check IP and Hostname</h2>
<p>We want to make sure that <code>/etc/hosts</code> has the correct IP address for <strong>linuxsysadmin</strong>:</p>
<pre><code>ip a
nano /etc/hosts # update IP address if changed</code></pre>
<p><strong>Tasks</strong></p>
<p>Copy the <em>login.php</em> and <em>pets.php</em> to your <code>public_html</code> directory (you should still have <em>userdir</em> enabled). Figure out what you need to change in order to get your script to work there.</p>
<h2 id="references-1">References</h2>
<ul>
<li><a href="https://www.tecmint.com/test-php-mysql-database-connection-using-script/">How to Test PHP MySQL Database Connection Using Script</a></li>
<li><a href="https://www.if-not-true-then-false.com/2010/install-apache-php-on-fedora-centos-red-hat-rhel/">Install Apache/PHP 7.2.12 on Fedora 29/28, CentOS/RHEL 7.5/6.10</a></li>
<li><a href="https://secure.php.net/manual/en/book.mysqli.php">MySQL Improved Extension</a></li>
<li><a href="https://www.w3schools.com/PHP/php_ref_mysqli.asp">PHP 5 MySQLi Functions</a></li>
</ul>
<p>Note: there might be an error with authentication due to a recent upgrade in MySQL that hasn’t caught up with PHP yet. If so, you might need to login as <strong>root</strong> to MySQL and run the following command, replacing the relevant information with your non-root user info:</p>
<pre><code>ALTER USER &#39;mysqlUsername&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;mysqlUsernamePassword&#39;;</code></pre>
</body>
</html>
